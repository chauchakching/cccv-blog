<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[cccv blog]]></title><description><![CDATA[cccv blog]]></description><link>https://cccv.blog</link><generator>GatsbyJS</generator><lastBuildDate>Wed, 03 May 2023 16:49:31 GMT</lastBuildDate><item><title><![CDATA[The Right Setup to Run TypeScript with Node.js and Importing ESM NPM Modules in a TypeScript Web Frontend]]></title><description><![CDATA[In this blog post, we will discuss the discovery and teaching of the right setup to run TypeScript with Node.js and importing some ESM NPM…]]></description><link>https://cccv.blog/2023-05-04-typescript-nodejs-scripts-folder-setup-with-esm-imports/</link><guid isPermaLink="false">https://cccv.blog/2023-05-04-typescript-nodejs-scripts-folder-setup-with-esm-imports/</guid><pubDate>Thu, 04 May 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In this blog post, we will discuss the discovery and teaching of the right setup to run TypeScript with Node.js and importing some ESM NPM modules, inside the &lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; folder, under the repo setup that is for a TypeScript web frontend, without changing config files on the repo root level.&lt;/p&gt;
&lt;h2 id=&quot;constraints-and-conditions&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#constraints-and-conditions&quot; aria-label=&quot;constraints and conditions permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Constraints and Conditions&lt;/h2&gt;
&lt;p&gt;Before we dive into the key points of the setup, let’s take a look at the constraints and conditions we will be working with:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The project should be a TypeScript web frontend.&lt;/li&gt;
&lt;li&gt;We should run TypeScript with Node.js and import ESM NPM modules.&lt;/li&gt;
&lt;li&gt;The setup should be done inside a &lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; folder.&lt;/li&gt;
&lt;li&gt;No config files on the repo root level should be changed.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Now, let’s proceed with the key points of the setup.&lt;/p&gt;
&lt;h2 id=&quot;key-points-of-the-setup&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#key-points-of-the-setup&quot; aria-label=&quot;key points of the setup permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Key Points of the Setup&lt;/h2&gt;
&lt;h3 id=&quot;1-run-ts-node-with---esm-flag&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-run-ts-node-with---esm-flag&quot; aria-label=&quot;1 run ts node with   esm flag permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. Run &lt;code class=&quot;language-text&quot;&gt;ts-node&lt;/code&gt; with &lt;code class=&quot;language-text&quot;&gt;--esm&lt;/code&gt; Flag&lt;/h3&gt;
&lt;p&gt;In order to run TypeScript with Node.js and import ESM NPM modules, we need to use the &lt;code class=&quot;language-text&quot;&gt;--esm&lt;/code&gt; flag when running &lt;code class=&quot;language-text&quot;&gt;ts-node&lt;/code&gt;. This enables support for ECMAScript modules.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;ts-node --esm script.ts&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;2-create-packagejson-in-the-scripts-folder&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-create-packagejson-in-the-scripts-folder&quot; aria-label=&quot;2 create packagejson in the scripts folder permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. Create &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt; in the &lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; Folder&lt;/h3&gt;
&lt;p&gt;Inside the &lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; folder, create a &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt; file with just one property, &lt;code class=&quot;language-text&quot;&gt;type: &quot;module&quot;&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;module&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This tells Node.js that all JavaScript files in this folder should be treated as ECMAScript modules.&lt;/p&gt;
&lt;h3 id=&quot;3-create-a-separate-tsconfigjson-in-the-scripts-folder&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-create-a-separate-tsconfigjson-in-the-scripts-folder&quot; aria-label=&quot;3 create a separate tsconfigjson in the scripts folder permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. Create a Separate &lt;code class=&quot;language-text&quot;&gt;tsconfig.json&lt;/code&gt; in the &lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; Folder&lt;/h3&gt;
&lt;p&gt;We need a separate &lt;code class=&quot;language-text&quot;&gt;tsconfig.json&lt;/code&gt; file in the &lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; folder to configure TypeScript for our Node.js scripts. This allows us to have different TypeScript configurations for the web frontend and the &lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; folder.&lt;/p&gt;
&lt;p&gt;Create a &lt;code class=&quot;language-text&quot;&gt;tsconfig.json&lt;/code&gt; file in the &lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; folder with the following content:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;compilerOptions&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;module&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ESNext&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;target&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ES2020&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;esModuleInterop&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;moduleResolution&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;node&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;outDir&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./dist&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;baseUrl&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;.&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;include&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;./**/*.ts&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This configuration sets the module system to &lt;code class=&quot;language-text&quot;&gt;ESNext&lt;/code&gt; and the target to &lt;code class=&quot;language-text&quot;&gt;ES2020&lt;/code&gt;, which enables support for ECMAScript modules and modern JavaScript features.&lt;/p&gt;
&lt;h3 id=&quot;4-use-js-extension-in-typescript-script-imports&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#4-use-js-extension-in-typescript-script-imports&quot; aria-label=&quot;4 use js extension in typescript script imports permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;4. Use &lt;code class=&quot;language-text&quot;&gt;.js&lt;/code&gt; Extension in TypeScript Script Imports&lt;/h3&gt;
&lt;p&gt;When importing another TypeScript file in the &lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; folder, use the &lt;code class=&quot;language-text&quot;&gt;.js&lt;/code&gt; extension for the relative import path, as required by the ESM specification in Node.js. However, do not use the &lt;code class=&quot;language-text&quot;&gt;.ts&lt;/code&gt; extension, as this will cause a TypeScript error.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Correct import statement&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; myFunction &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./myModule.js&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Incorrect import statement&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; myFunction &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./myModule.ts&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By following these key points, you can set up a TypeScript project with Node.js and import ESM NPM modules without changing any config files on the repo root level, while keeping everything inside the &lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; folder.&lt;/p&gt;
&lt;hr&gt;
&lt;h1 id=&quot;generated-by-chatgpt-gpt-4&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#generated-by-chatgpt-gpt-4&quot; aria-label=&quot;generated by chatgpt gpt 4 permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Generated by ChatGPT gpt-4&lt;/h1&gt;
&lt;p&gt;The above blog post was 100% generated by gpt-4 with the following prompt:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;write a blog post in markdown syntax about the discovery and teaching of the right setup to run typescript with nodejs and importing some esm npm modules, inside &lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; folder, under the repo setup that is for a typescript web frontend, without changing config files on the repo root level.
Specify the constraints and conditions beforehand.&lt;/p&gt;
&lt;p&gt;Then, for the key points of the setup involves&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;running &lt;code class=&quot;language-text&quot;&gt;ts-node&lt;/code&gt; with &lt;code class=&quot;language-text&quot;&gt;--esm&lt;/code&gt; flag&lt;/li&gt;
&lt;li&gt;creating &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt; in the &lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; folder, with just one property &lt;code class=&quot;language-text&quot;&gt;type: &quot;module&quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;creating a separate &lt;code class=&quot;language-text&quot;&gt;tsconfig.json&lt;/code&gt; in the &lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; folder&lt;/li&gt;
&lt;li&gt;in typescript script in&lt;code class=&quot;language-text&quot;&gt;scripts&lt;/code&gt; folder, when importing another ts file, the relative import path should includes extension &lt;code class=&quot;language-text&quot;&gt;.js&lt;/code&gt; because of esm requirement of nodejs, but not &lt;code class=&quot;language-text&quot;&gt;.ts&lt;/code&gt; because of typescript error&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;</content:encoded></item><item><title><![CDATA[Why brwoser redirect to different domain with text "/\abc.com"?]]></title><description><![CDATA[If I run this script , where would the browser take me to? ? or ?
When I first bumped into this question, I thought I knew how the browser’s…]]></description><link>https://cccv.blog/2023-04-12-why-brwoser-redirect-to-different-domain/</link><guid isPermaLink="false">https://cccv.blog/2023-04-12-why-brwoser-redirect-to-different-domain/</guid><pubDate>Wed, 12 Apr 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;If I run this script&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// originally on https://example.com&lt;/span&gt;
window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;href &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/\\abc.com&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;, where would the browser take me to? &lt;code class=&quot;language-text&quot;&gt;example.com/\abc.com&lt;/code&gt;? or &lt;code class=&quot;language-text&quot;&gt;abc.com&lt;/code&gt;?
When I first bumped into this question, I thought I knew how the browser’s behavior pretty well.&lt;/p&gt;
&lt;h1 id=&quot;analysis&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#analysis&quot; aria-label=&quot;analysis permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Analysis&lt;/h1&gt;
&lt;p&gt;The string &lt;code class=&quot;language-text&quot;&gt;&quot;/\\abc.com&quot;&lt;/code&gt; in js has an extra backslash to escape the backslash to represent text &lt;code class=&quot;language-text&quot;&gt;/\abc.com&lt;/code&gt;.
As the string starts with a single forward slash &lt;code class=&quot;language-text&quot;&gt;/&lt;/code&gt;, it should be a relative path, right? But no.
When I run&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;href &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/\\abc.com&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;, browser takes me to &lt;code class=&quot;language-text&quot;&gt;abc.com&lt;/code&gt;.
Which means it is indeed an absolute path. Why??&lt;/p&gt;
&lt;p&gt;Here are the most common cases of browser redirect (potentially relative) url for redirect:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;https://google.com&lt;/code&gt;: includes protocol/scheme &lt;code class=&quot;language-text&quot;&gt;https&lt;/code&gt;, so it’s an absolute path&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;//abc.com&lt;/code&gt;: not that common, but &lt;a href=&quot;https://stackoverflow.com/questions/6785442/browser-support-for-urls-beginning-with-double-slash&quot;&gt;it’s an absolute path&lt;/a&gt; and stated in in RFC 1808&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;/home&lt;/code&gt;: the usual relative path&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;apple&lt;/code&gt;: a relative path, and the redirect will replace the last part of pathname with &lt;code class=&quot;language-text&quot;&gt;apple&lt;/code&gt; e.g. &lt;code class=&quot;language-text&quot;&gt;example.com/a/b/c&lt;/code&gt; -&gt; &lt;code class=&quot;language-text&quot;&gt;example.com/a/b/apple&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;home.html&lt;/code&gt;: a relative path, similar to &lt;code class=&quot;language-text&quot;&gt;apple&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;/home.html&lt;/code&gt;: a relative path, similar to &lt;code class=&quot;language-text&quot;&gt;home.html&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;None of the cases have anything to do with the backslash &lt;code class=&quot;language-text&quot;&gt;\&lt;/code&gt;.&lt;/p&gt;
&lt;h1 id=&quot;mdn&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#mdn&quot; aria-label=&quot;mdn permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;MDN?&lt;/h1&gt;
&lt;p&gt;Didn’t mention anything special about backslash.&lt;/p&gt;
&lt;h1 id=&quot;google&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#google&quot; aria-label=&quot;google permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Google?&lt;/h1&gt;
&lt;p&gt;Couldn’t really find anything related to url redirect with backslash.&lt;/p&gt;
&lt;h1 id=&quot;would-chatgpt-gpt-4-know-the-answer&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#would-chatgpt-gpt-4-know-the-answer&quot; aria-label=&quot;would chatgpt gpt 4 know the answer permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Would ChatGPT (GPT-4) know the answer?&lt;/h1&gt;
&lt;p&gt;Let’s give it a try.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/152c41e1de5d1b01db51e2cebf4ed392/17d12/ask-chatgpt-1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 96.20253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAAC9klEQVQ4y41U2W7TUBB1kXirxG8h9T8QVCgVBbXJP7RNaatGLYjlqbzDC18BbbPvcRzHjndn85qDZhwnKeWBKx3N3JnrubOca2E+90DwPP8BfH8tHWcMy3Iwm81Xds9bf0P2FEIURXxoPB7DMEw4jgvLslknaZoWS7LbtsM6yXRP38VxjMViwRBoE4YhdN2AJMlQVQ3DocpQlETKQ4UD+UGwrMbjb+aeB98PsLkEys513fUt8WJ1W4rUR2vTTitNKAgChiDLQ9zcfIM0UNBoddHuiKjWmqjVWywbzQ66PQn1RhvNpb/e7KDV7vF5sS9DHqpw3QkmkykEauR0OoNhWFAUDUNlBFXVoY4S0F7TDCiqhoGsYDRa+yjQeDzhNlAckhyQJkUf0u10Y08cMCgztkky2t3+ytYVJZZ0li5Kg/GUk4AeO6msVkfcCCyhRrZleVQ+ldtYlkyg1ui6uaKPkEa3bIfLJtABg+niwDRtttm2C92weE+gPZ3RmWrjvzP0OaNSuY5ytcFZVapN1inrX7clHlCxXEepUsd9qYa7YpX1Sq0Jw7QfB6RedDoi90nsD7jhhL40RLvTQ78vw3ZcmJbDhGbpuElVpvXvoVBP2tzDHgdaDUeU+BKaNrVjpBms08SJ8I+mTAqlTUFHmglNNzljVdNh2S4HT/waxpMp5jSAuYfpMhlaq5KJg1EY4fuPnzg+LeAkf4mj4wtG/uQSp/kCjo8ukM8XkD8t4P3ZFc7Pr3F2doXLwidcXX/F5y83/ObpGQrEblo7z3cgCAK2tp5CEJ6w/r/Y3n6GbldEFMVJhvEC+Hj9Aa9fvEQum0U2e4jDgwPs7b9B5t0+Mm/3Wd/LZJBZYm8vwe7uK+RyOWianmSY1u4HIbwggueH8IMIszk99ogRBjECQhizj/S5FzDIRouCPaANTff3bYm5eF9KOFYs1xK9XMddsYIi86/CPuJl+sMg6jzgIb8Uy2EaEKdoyvQaUpqkLyTRTT4bBskvizLbpM0fUIJJ0TWZsg8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ask-chatgpt-1&quot;
        title=&quot;ask-chatgpt-1&quot;
        src=&quot;/static/152c41e1de5d1b01db51e2cebf4ed392/f058b/ask-chatgpt-1.png&quot;
        srcset=&quot;/static/152c41e1de5d1b01db51e2cebf4ed392/c26ae/ask-chatgpt-1.png 158w,
/static/152c41e1de5d1b01db51e2cebf4ed392/6bdcf/ask-chatgpt-1.png 315w,
/static/152c41e1de5d1b01db51e2cebf4ed392/f058b/ask-chatgpt-1.png 630w,
/static/152c41e1de5d1b01db51e2cebf4ed392/40601/ask-chatgpt-1.png 945w,
/static/152c41e1de5d1b01db51e2cebf4ed392/78612/ask-chatgpt-1.png 1260w,
/static/152c41e1de5d1b01db51e2cebf4ed392/17d12/ask-chatgpt-1.png 1666w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Nahhh, wrong. ChatGPT thought &lt;code class=&quot;language-text&quot;&gt;/\abc.com&lt;/code&gt; was a relative path too.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/36d264751eaa2f55788959c2d6696726/17d12/ask-chatgpt-2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 93.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAACtklEQVQ4y5VUyXLTQBBVAlwgyddk4UAwF4pvyOfAhTP5DKjKH4RzuMQLjixL3rTLi6SRvMlL/KhuWeMslQOueu6entGbN909o2TZAkF/iFpdg6a3cdcw0NBa0I0OW1UzdrbZ4nnL9uAHA/QHI4RhjPk8w2w2ZyhEWGCxWErsYgs5pg8JNF4uV3JtEScoWZazx0JAiAQiSRDHAkmSIk1TGUvTMe7v77HZbNjusOFYAYX+1us1iDiTO82lOo5nGZbLJV76PSK8vv4N3w+QJGMIkeY2SXOIwpLqBFEk2LIfC4RRjCQd8wknk2mew5ubP+j2LE64bnTRNDpo6h1ozTbbVseE3upywWieCtTuWhyjolAq6FSSkCRPp3PeLYwE70wgdWRHo4grSRiFESsin1QSGakmsqIWCrH3t21DKrlFGgbqqg6t2UK1puJvXcOdqrMllXW1KddXaiqLoZzLtiElpuVwf5m2y7ZnOjAtF7bjy5jleLBsl+N+MMxPFcaYTGayF5mQ5NMHjuvD9QLYjsdEnt/PiWyXfdcN5HwQDPO0RALj8eQ5Yadnsyoi7W79h5ZI2TcplseNVo/niFjmkHptMBhxddvbihLoA1a9VUQbFcopRsR5POCiSIVEOByGnPBOx4Kq6lAbOkzT4SM6jg+XUkHHfQLP6/P8cBjtCKltfv66wulpCefnn3F2VsLZ+084Of2I45Pzxzj+8MiWSl94/ddv37HZUPvNcsLLH5dQFAVHb9/h8OgQBwcH2Hu1D+X1Xo43+zz/Ei4uLvgK0tEVei2CoI9yuYJqtca2QKVc3aKCSqX6DLT+9raMXs982ocJbIdaos++SMaIRcogn24Q2ShKeD6OU47lNpFPl7wp9CAEwYCLU9zJ2XTGoLzQOLcPMZd+sYYJV6s1P1/F+0bj1Wr1n1hL/ANXr0lcLun6QwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ask-chatgpt-2&quot;
        title=&quot;ask-chatgpt-2&quot;
        src=&quot;/static/36d264751eaa2f55788959c2d6696726/f058b/ask-chatgpt-2.png&quot;
        srcset=&quot;/static/36d264751eaa2f55788959c2d6696726/c26ae/ask-chatgpt-2.png 158w,
/static/36d264751eaa2f55788959c2d6696726/6bdcf/ask-chatgpt-2.png 315w,
/static/36d264751eaa2f55788959c2d6696726/f058b/ask-chatgpt-2.png 630w,
/static/36d264751eaa2f55788959c2d6696726/40601/ask-chatgpt-2.png 945w,
/static/36d264751eaa2f55788959c2d6696726/78612/ask-chatgpt-2.png 1260w,
/static/36d264751eaa2f55788959c2d6696726/17d12/ask-chatgpt-2.png 1666w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Even given with feedback to correct the answer, ChatGPT couldn’t tell why.&lt;/p&gt;
&lt;h1 id=&quot;more-background&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#more-background&quot; aria-label=&quot;more background permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;More background&lt;/h1&gt;
&lt;p&gt;Actually my ultimate goal was to create a function that determines if a string would
cause domain change in browser redirect. Long story short, with the help of ChatGPT,
I have the following function:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;willDomainChangeWhenRedirect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Create a link element to easily parse the input URL&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; link &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  link&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;href &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; url

  &lt;span class=&quot;token comment&quot;&gt;// Get the hostname of the input URL and the current window&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; newHostname &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; link&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hostname
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; currentHostname &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hostname

  &lt;span class=&quot;token comment&quot;&gt;// Compare the hostnames and return true if they are different&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; newHostname &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; currentHostname
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;At the end, I had to rely on browser’s implementation to parse the url string and get the hostname.
Any custom logic in implementation could differs from the browser’s implementation.
I wonder: what is the url construction logic in the browser engine?&lt;/p&gt;
&lt;h1 id=&quot;checking-chromium-source-code&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#checking-chromium-source-code&quot; aria-label=&quot;checking chromium source code permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Checking chromium source code&lt;/h1&gt;
&lt;p&gt;I was left with one final choice: check the source code of chromium. But the project is huge.
It would take me lots of time! What if, we ask ChatGPT for guidance?&lt;/p&gt;
&lt;p&gt;Let’s start from asking for entry point of reading the source code.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3f77253bcfb82cd039b6686282d7c95b/81315/ask-chatgpt-chromium-1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 108.22784810126582%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC1ElEQVQ4y41V13biUAzk/38n+xubSrFxwwbcO25AwuwZ2dcLyT4s50xun0gaSV70/YBhOAvO5wvO5/M3XFBVJxRFja4bZP33/nlek4dYXK9XOWjaFnV9EpxOjUDN1b5C13Vo2246q9G2Lb6+vgRC2Pc9/CBEnhcy58WmaQV8qOZqPQyD3CMR73ZdD/VbkPV2Az4/P/G/v9vtJvi7Mb4nFpqm4+npF7KshLf3cfQj7A/+hACHYyj7vh/JyLXsH4L5Ps/quhEs6Kbn7eXQsl04uz1sx4O982ROGNYO5h14btoutqYDy/Hg7o/iuohClS6XK3buAbphwzAdma83WyzXOpYrDdrWEhISbDQTUZQgSXMkSYY4ySS2JGMsF/xD5EWJPC+RZQWKspIx5aM0G/fzYlK4v0uxEYpMLFSLKE5xOAZT3AIc/VDAOeMWRgmatpsff8eDhVzQmo1mYGvYEic16ltL9hmKIIz/SXZPOhPSgt8vH3hfbvD6tsLL2wrPrx9Ya4bEz7AcEY1W+0EkY1nWEn8WxmyhmjBOfGA7rljk7EYSClBWNYqikjinWSGCqPgqYdopHDNhGCaSHlR0o5uSFlRd0y3ZW1H1lS7Wv39s8Py6hGHaco8WP7hM1agg40T3mJOMIUcmuOsdZc1/5HoH8YZWNk0n1XG9XH+KQpf4eFR6HKM4mVQeK4OiMG7KfaYXQ8CU+pE2JFGVwcQmCWOqoBJeVRRd5ZpikvyHy0wPxoXxYdx4mVVCrNb6TMJ4rjeGjKwc7rEIyDGr3La9WGZaLhx3L/mnrDUnItY240tiZgFLk6Sabsre3GCVy1TK2x8n+KinJjs20bHJsnOPe+1d821QTSX5mDZRgjCMhZigAIIgRhyniKJ0zjmuBdOcxMP35kDL7l2j63M723nyWClLiNqcF9Vjt1EfGX4KpOteR6g1y4o9s5BuVMhDlttF2t4I3lEfrT/NV3hZoRnKsgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ask-chatgpt-chromium-1&quot;
        title=&quot;ask-chatgpt-chromium-1&quot;
        src=&quot;/static/3f77253bcfb82cd039b6686282d7c95b/f058b/ask-chatgpt-chromium-1.png&quot;
        srcset=&quot;/static/3f77253bcfb82cd039b6686282d7c95b/c26ae/ask-chatgpt-chromium-1.png 158w,
/static/3f77253bcfb82cd039b6686282d7c95b/6bdcf/ask-chatgpt-chromium-1.png 315w,
/static/3f77253bcfb82cd039b6686282d7c95b/f058b/ask-chatgpt-chromium-1.png 630w,
/static/3f77253bcfb82cd039b6686282d7c95b/40601/ask-chatgpt-chromium-1.png 945w,
/static/3f77253bcfb82cd039b6686282d7c95b/78612/ask-chatgpt-chromium-1.png 1260w,
/static/3f77253bcfb82cd039b6686282d7c95b/81315/ask-chatgpt-chromium-1.png 1656w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;That’s a good start! Then I follow the steps to try to get to the source code:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;the chromium source code link is real,&lt;/li&gt;
&lt;li&gt;the directory path is also real,&lt;/li&gt;
&lt;li&gt;the directory do contains the file &lt;code class=&quot;language-text&quot;&gt;html_anchor_element.cc&lt;/code&gt;,&lt;/li&gt;
&lt;li&gt;I couldn’t find the methods &lt;code class=&quot;language-text&quot;&gt;SetURLAttribute()&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;GetURLAttribute()&lt;/code&gt;, but&lt;/li&gt;
&lt;li&gt;I did find &lt;a href=&quot;https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/core/html/html_anchor_element.cc;l=309&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;HTMLAnchorElement::Href()&lt;/code&gt;&lt;/a&gt;, which is exactly what we’re looking for!&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8960aec7d9a16bc65ae61c18bb41a2f9/28b65/ask-chatgpt-chromium-2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.632911392405056%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6klEQVQoz22SycrbMBRG/bTd9dG6a1+gFLrqolDaP4mHxLM1eZQlx05OsQOFwi846HLhHulDCqxbmZ1DaU0jBI2QdF2HNhohJVIbVD+henvUUmnU3tMGbVpKNZCLntHOhycw40qjO0zbUqseZTq68Y7qFio1URY58s831Ok7Q98x+wU7O6zz2NnTDjO632Ue5z2B7hxt/8TOMLuFcXKc0x+cbl84pT8JS0+YNFyugrhZSORGIlcSsRKLO1e5HrzqO8Gv8Ex8+8Q1/0yhRkR3p6oyjMio6xQpDZNb8RvM/o7zy3Gw8yvL+vgPf98IwuQrcfKBS/QRoRsGu2HMgCkN13PI9Xw6YpdlQZYVFJWiEQo7TTweD7ZtPXhsG8uyEMRxTJyERNEFa2eGcUIqxSAG0nNOVdZHLy8riqomrxrKqqFqBHlRkuY5WV7QSIWdZ4IwvhFGNy7hlbISNFITpw1KdlSVpKoFSRJxfjtxS4tDsouzojrYxXUjqYU8HjRIs1eUfR9Gy2gdQrX0eiDPd0FBePlNdHmjyEvquqFtW4wxR6JX7J2NddsIrreMnV042f07LChpaM0+pI/Btu0YuomhH7B2wnvP8/nkvRWEUcL5ErHvh3D2SGWQtaIsyuM20zThJse6rv8Gd+F7/AXQpvIgmJMUHQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ask-chatgpt-chromium-2&quot;
        title=&quot;ask-chatgpt-chromium-2&quot;
        src=&quot;/static/8960aec7d9a16bc65ae61c18bb41a2f9/f058b/ask-chatgpt-chromium-2.png&quot;
        srcset=&quot;/static/8960aec7d9a16bc65ae61c18bb41a2f9/c26ae/ask-chatgpt-chromium-2.png 158w,
/static/8960aec7d9a16bc65ae61c18bb41a2f9/6bdcf/ask-chatgpt-chromium-2.png 315w,
/static/8960aec7d9a16bc65ae61c18bb41a2f9/f058b/ask-chatgpt-chromium-2.png 630w,
/static/8960aec7d9a16bc65ae61c18bb41a2f9/40601/ask-chatgpt-chromium-2.png 945w,
/static/8960aec7d9a16bc65ae61c18bb41a2f9/78612/ask-chatgpt-chromium-2.png 1260w,
/static/8960aec7d9a16bc65ae61c18bb41a2f9/28b65/ask-chatgpt-chromium-2.png 2414w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;I haven’t written C++ since uni. But my rusty C++ knowledge served me good.
After some digging, I traced to the &lt;a href=&quot;https://source.chromium.org/chromium/chromium/src/+/refs/heads/main:third_party/blink/renderer/core/dom/document.cc;l=7096;drc=9329f990b89052f1e7f82e0a1a4b298b72359263;bpv=1;bpt=1&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;KURL()&lt;/code&gt;&lt;/a&gt; constructor in &lt;code class=&quot;language-text&quot;&gt;third_party/blink/renderer/core/dom/document.cc&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d202f083210ce6cddce2c23841369b9d/28b65/ask-chatgpt-chromium-3.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.632911392405056%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABw0lEQVQoz2WS647bIBBG/f6PV6mrtkm8dmJzNQQH8CXO7qnMRmnV/jj6vgFmxMBU07IxzwuDc2hj0MYSQsB5j7G2sO9Z5zCDww5fOnhf/H7ePNeUsVQ+bmgX8eGGHkYGHwhxYQgZYTzShuLztDAt6xfzQp6Xon9YiXmiciERxkjKX0kpT7w1nu9t5KQ3fomFn/3MQS4c1cJBzpz0Sm02anOn1veXNvZO9e3k+HEeEW5FhTs2rPRCE2NmWe+Mt1RIaeaWMjFNrOuD7QO2x+d/VMdGULcKF6bS6hgXemkwakArQ9cLRC8ZjMfagasbWZeNj09efP7lq7puqOt3mvZckpUynM6GVjg65eiV49wbLtIg1ZVeOC7CYq8Z6xPGR/RwwxSfqI6nhlPdcKwbpDLcYkZpQ756vNE47xgGi3WhtJ7z3n4sujPlTErpFVfnS8+lE7w3l1Js/6BeakbjUZ3i0gvac8e5l3RCIZVGSEUn5Ev3kYkplzeumvZSEoTUpDyTp7XMY75m2uOBrmuRokcriTGKwRpyikzlds+b7fGUC9Xh9M7hWJei+9jsBTt9xZoRHzLj9GDMj6duhHTnNn8Q/+H25DdFoPWpmla6JwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ask-chatgpt-chromium-3&quot;
        title=&quot;ask-chatgpt-chromium-3&quot;
        src=&quot;/static/d202f083210ce6cddce2c23841369b9d/f058b/ask-chatgpt-chromium-3.png&quot;
        srcset=&quot;/static/d202f083210ce6cddce2c23841369b9d/c26ae/ask-chatgpt-chromium-3.png 158w,
/static/d202f083210ce6cddce2c23841369b9d/6bdcf/ask-chatgpt-chromium-3.png 315w,
/static/d202f083210ce6cddce2c23841369b9d/f058b/ask-chatgpt-chromium-3.png 630w,
/static/d202f083210ce6cddce2c23841369b9d/40601/ask-chatgpt-chromium-3.png 945w,
/static/d202f083210ce6cddce2c23841369b9d/78612/ask-chatgpt-chromium-3.png 1260w,
/static/d202f083210ce6cddce2c23841369b9d/28b65/ask-chatgpt-chromium-3.png 2414w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Here is the &lt;code class=&quot;language-text&quot;&gt;KURL&lt;/code&gt; init function&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KURL&lt;/span&gt;&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; KURL&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; base&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; String&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; relative&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; WTF&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;TextEncoding&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; query_encoding&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// As a performance optimization, we do not use the charset converter&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// if encoding is UTF-8 or other Unicode encodings. Note that this is&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// per HTML5 2.5.3 (resolving URL). The URL canonicalizer will be more&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// efficient with no charset converter object because it can do UTF-8&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// internally with no extra copies.&lt;/span&gt;

  StringUTF8Adaptor &lt;span class=&quot;token function&quot;&gt;base_utf8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GetString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// We feel free to make the charset converter object every time since it&apos;s&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// just a wrapper around a reference.&lt;/span&gt;
  KURLCharsetConverter &lt;span class=&quot;token function&quot;&gt;charset_converter_object&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;query_encoding&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  KURLCharsetConverter&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; charset_converter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;query_encoding &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;IsUnicodeEncoding&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;query_encoding&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;nullptr&lt;/span&gt;
          &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;charset_converter_object&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Clamp to int max to avoid overflow.&lt;/span&gt;
  url&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;RawCanonOutputT&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; output&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;relative&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IsNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; relative&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Is8Bit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    StringUTF8Adaptor &lt;span class=&quot;token function&quot;&gt;relative_utf8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;relative&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    is_valid_ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; url&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ResolveRelative&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base_utf8&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; base_utf8&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                                     base&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parsed_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; relative_utf8&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                                     &lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ClampTo&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;relative_utf8&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                                     charset_converter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;output&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;parsed_&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    is_valid_ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; url&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ResolveRelative&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base_utf8&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; base_utf8&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                                     base&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parsed_&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; relative&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Characters16&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                                     &lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ClampTo&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;relative&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                                     charset_converter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;output&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;parsed_&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// url canonicalizes to 7-bit ASCII, using punycode and percent-escapes&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// This makes it safe to call FromUTF8() below and still keep using parsed_&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// which stores byte offsets: Since it&apos;s all ASCII, UTF-8 byte offsets&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// map 1-to-1 to UTF-16 codepoint offsets.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;size_t i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; output&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;DCHECK&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;WTF&lt;/span&gt;&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IsASCII&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;output&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// AtomicString::fromUTF8 will re-hash the raw output and check the&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// AtomicStringTable (addWithTranslator) for the string. This can be very&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// expensive for large URLs. However, since many URLs are generated from&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// existing AtomicStrings (which already have their hashes computed), this&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// fast path is used if the input string is already canonicalized.&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Because this optimization does not apply to non-AtomicStrings, explicitly&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// check that the input is Atomic before moving forward with it. If we mark&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// non-Atomic input as Atomic here, we will render the (const) input string&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// thread unsafe.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;relative&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IsNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; relative&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Impl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IsAtomic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;StringView&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;output&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token generic-function&quot;&gt;&lt;span class=&quot;token function&quot;&gt;static_cast&lt;/span&gt;&lt;span class=&quot;token generic class-name&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;unsigned&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;output&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;
          relative&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    string_ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; relative&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    string_ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AtomicString&lt;/span&gt;&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;FromUTF8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;output&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; output&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;InitProtocolMetadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;InitInnerURL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;DCHECK&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;blink&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ProtocolIsJavaScript&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;string_&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ProtocolIsJavaScript&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Check for deviation characters in the string. See&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// https://unicode.org/reports/tr46/#Table_Deviation_Characters&lt;/span&gt;
  has_idna2008_deviation_character_ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
      base&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;has_idna2008_deviation_character_ &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt;
      relative&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Contains&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;u&lt;span class=&quot;token string&quot;&gt;&quot;\u00DF&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Sharp-s&lt;/span&gt;
      relative&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Contains&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;u&lt;span class=&quot;token string&quot;&gt;&quot;\u03C2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Greek final sigma&lt;/span&gt;
      relative&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Contains&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;u&lt;span class=&quot;token string&quot;&gt;&quot;\u200D&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Zero width joiner&lt;/span&gt;
      relative&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Contains&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;u&lt;span class=&quot;token string&quot;&gt;&quot;\u200C&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;token comment&quot;&gt;// Zero width non-joiner&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;url::ResolveRelative()&lt;/code&gt; function seems to be one holding the logic.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7ff2356ab737c05cd4fafa5854d2ea46/764d0/ask-chatgpt-chromium-4.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2ElEQVQoz42R63KjMAxGef9n685k2m2SDQkkhADmahNjm1vODrDt361nzkiW7U+y5CltyaUlbzqySiPqhc0vpaEzjs72P8Yrm5a3U8N75DikL/bJxCGd/9mJk3jxJ504JuN/8bMRT2vLI815tppGFDRlRS0KVNkiS0mdV1jjGCYYpxfjYueNYXptjC/6cbOe7hyJqCnLlo/3PW+/dux2H/ifvzn+3vH5scM/XxFFje1njBvp7EBnR9ww44bXmmh+bXi6s/hRRdkOa+9EbUgLRRAcCYMDl8Bn7985nmPCe8HlJgiinEskKFVPrWe0nXBrsgnvqR1lVTFYR68tMDMOA22ryYuKoqhopMJagzEd1hics99702m03nDO4T2qHpGXONfTqhZj7HpYlBWn8wX/EnAOQoLrjdM5WDmefKI4IYof3O7xN7Vstx4ugn3f87WWCutGEt6ib67RnVsUEyfp+nixjzQjTrLVTzJBLRVeZyyiqLD6SZelPKOI9vGgKEou4ZXwGhFcN9FFQBQlqShIRb6KLLHFX2KNarehLIK6VsT7AyIMEGGIlJIkyyiqCtU+qaVEqnbt5xfLL1akoqobtDF42mxf7jqzDkeq5WJDIyVKqR/TKrUW8RfobD9A13lxyAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ask-chatgpt-chromium-4&quot;
        title=&quot;ask-chatgpt-chromium-4&quot;
        src=&quot;/static/7ff2356ab737c05cd4fafa5854d2ea46/f058b/ask-chatgpt-chromium-4.png&quot;
        srcset=&quot;/static/7ff2356ab737c05cd4fafa5854d2ea46/c26ae/ask-chatgpt-chromium-4.png 158w,
/static/7ff2356ab737c05cd4fafa5854d2ea46/6bdcf/ask-chatgpt-chromium-4.png 315w,
/static/7ff2356ab737c05cd4fafa5854d2ea46/f058b/ask-chatgpt-chromium-4.png 630w,
/static/7ff2356ab737c05cd4fafa5854d2ea46/40601/ask-chatgpt-chromium-4.png 945w,
/static/7ff2356ab737c05cd4fafa5854d2ea46/78612/ask-chatgpt-chromium-4.png 1260w,
/static/7ff2356ab737c05cd4fafa5854d2ea46/764d0/ask-chatgpt-chromium-4.png 1898w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;And then I traced to &lt;a href=&quot;https://source.chromium.org/chromium/chromium/src/+/refs/heads/main:url/url_util.cc;drc=9329f990b89052f1e7f82e0a1a4b298b72359263;l=317&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;DoResolveRelative()&lt;/code&gt;&lt;/a&gt; in &lt;code class=&quot;language-text&quot;&gt;url/url_util.cc&lt;/code&gt;. We’re getting close!&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CHAR&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;DoResolveRelative&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; base_spec&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                       &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; base_spec_len&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                       &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Parsed&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; base_parsed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                       &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; CHAR&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; in_relative&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                       &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; in_relative_length&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                       CharsetConverter&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; charset_converter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                       CanonOutput&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; output&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                       Parsed&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; output_parsed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Remove any whitespace from the middle of the relative URL, possibly&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// copying to the new buffer.&lt;/span&gt;
  STACK_UNINITIALIZED RawCanonOutputT&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;CHAR&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; whitespace_buffer&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; relative_length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; CHAR&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; relative &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RemoveURLWhitespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      in_relative&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; in_relative_length&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;whitespace_buffer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;relative_length&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;output_parsed&lt;span class=&quot;token operator&quot;&gt;-&gt;&lt;/span&gt;potentially_dangling_markup&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; base_is_authority_based &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; base_is_hierarchical &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base_spec &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
      base_parsed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scheme&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;is_nonempty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; after_scheme &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; base_parsed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scheme&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Skip past the colon.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; num_slashes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;CountConsecutiveSlashes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base_spec&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; after_scheme&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                                              base_spec_len&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    base_is_authority_based &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; num_slashes &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    base_is_hierarchical &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; num_slashes &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  SchemeType unused_scheme_type &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; SCHEME_WITH_HOST_PORT_AND_USER_INFORMATION&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; standard_base_scheme &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
      base_parsed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scheme&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;is_nonempty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;DoIsStandard&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base_spec&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; base_parsed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scheme&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;unused_scheme_type&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; is_relative&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  Component relative_component&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IsRelativeURL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base_spec&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; base_parsed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; relative&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; relative_length&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                     &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base_is_hierarchical &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; standard_base_scheme&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                     &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;is_relative&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;relative_component&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Error resolving.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Don&apos;t reserve buffer space here. Instead, reserve in DoCanonicalize and&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ReserveRelativeURL, to enable more accurate buffer sizes.&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Pretend for a moment that |base_spec| is a standard URL. Normally&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// non-standard URLs are treated as PathURLs, but if the base has an&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// authority we would like to preserve it.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;is_relative &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; base_is_authority_based &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;standard_base_scheme&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Parsed base_parsed_authority&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;ParseStandardURL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base_spec&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; base_spec_len&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;base_parsed_authority&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base_parsed_authority&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;host&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;is_nonempty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      STACK_UNINITIALIZED RawCanonOutputT&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; temporary_output&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; did_resolve_succeed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
          &lt;span class=&quot;token function&quot;&gt;ResolveRelativeURL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base_spec&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; base_parsed_authority&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; relative&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                             relative_component&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; charset_converter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                             &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;temporary_output&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; output_parsed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// The output_parsed is incorrect at this point (because it was built&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// based on base_parsed_authority instead of base_parsed) and needs to be&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// re-created.&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;DoCanonicalize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;temporary_output&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; temporary_output&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                     REMOVE_WHITESPACE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; charset_converter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; output&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                     output_parsed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; did_resolve_succeed&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;is_relative&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Relative, resolve and canonicalize.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; file_base_scheme &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; base_parsed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scheme&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;is_nonempty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;DoCompareSchemeComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base_spec&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; base_parsed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scheme&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; kFileScheme&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ResolveRelativeURL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base_spec&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; base_parsed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; file_base_scheme&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; relative&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                              relative_component&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; charset_converter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; output&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                              output_parsed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Not relative, canonicalize the input.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;DoCanonicalize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;relative&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; relative_length&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                        DO_NOT_REMOVE_WHITESPACE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; charset_converter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; output&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                        output_parsed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And then we get closer:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/d2b9dd32cde521ab97f9a029f0ab4409/691b3/ask-chatgpt-chromium-5.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 77.21518987341771%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACZUlEQVQ4y42T6W7jNhhF9f4P1gKTH8V0Ei+JY+2UKFMURVGSbS2nED1t08y0KIGDSwrk1beQgTI9UWFRZqS2t/+Faq//QNuRZqO7Esja8vt7TawmUr2S1DNJvfi5X6uZ+BPJB7a10HfK5uY10K0jjhuyUBOeJO/nAiEMlezJCo0yA90Idliw44odfuQ+rUwznqAxHapumaaV63XiPi/orGP3/Mr++Mrb6Uw/3JgX/MH7/CPLsrKsD4LGWNq25eMQmeBw2PP29kYcR/TOMQzDhx0r/zaCpu3QjaHJMuok8Zof9sg45pJl6LKk0xqrFKO1TM7BunrLddNPBGYzrBtEJNjtXjidTuRZRpokpGmKEAKtNY3WOOcYx5Hb7faI82eGj5Q7nO3J85yyLL1JIQqkkFSXCmsty7IwTZM32/Q/U25qwyVXxElMGIaeMpXoqqHve7rOedPWWh9l13VY23nd6u++13j7kU/ZtBZnHHkuPEVRIqWklBIhCh91WUqfQVEU3/cUft+fWTVN400DWSm0bjDGoFSNrCqUNvTDiHM9/TB4hmH0Ol6v3O53pmn2ujHPi4/UG2Z5QVUpjDZEScLL/sDzbs/ucPTzTbf7uOn2/T2MiNMMeVEY29G0lrZz1LVmHAeCNBN+cR2uyEtNmGSco4TTOSSM/9ZzFBPGKYWsyESBNi2t672ZdT2dc75hQS5K1EWTRSlPT7/w5elXfvv6lW/PLxyOr+x9hMe/5sfXN5I046IUqtaouuaiakzbMs/zI2WtDa5tKOITRXTifXshSUIURf4KbV3fdCu+tY+DW0c/s93DPwDbo3EYhORtbwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ask-chatgpt-chromium-5&quot;
        title=&quot;ask-chatgpt-chromium-5&quot;
        src=&quot;/static/d2b9dd32cde521ab97f9a029f0ab4409/f058b/ask-chatgpt-chromium-5.png&quot;
        srcset=&quot;/static/d2b9dd32cde521ab97f9a029f0ab4409/c26ae/ask-chatgpt-chromium-5.png 158w,
/static/d2b9dd32cde521ab97f9a029f0ab4409/6bdcf/ask-chatgpt-chromium-5.png 315w,
/static/d2b9dd32cde521ab97f9a029f0ab4409/f058b/ask-chatgpt-chromium-5.png 630w,
/static/d2b9dd32cde521ab97f9a029f0ab4409/40601/ask-chatgpt-chromium-5.png 945w,
/static/d2b9dd32cde521ab97f9a029f0ab4409/78612/ask-chatgpt-chromium-5.png 1260w,
/static/d2b9dd32cde521ab97f9a029f0ab4409/691b3/ask-chatgpt-chromium-5.png 2156w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;At first glance, the function &lt;code class=&quot;language-text&quot;&gt;IsRelativeURL()&lt;/code&gt; only process the params and return a boolean.
But after a closer look, the function is also putting the url result in the
pointer param. Oh right, it’s a norm to do that in C++.&lt;/p&gt;
&lt;p&gt;And finally we get to &lt;a href=&quot;https://source.chromium.org/chromium/chromium/src/+/refs/heads/main:url/url_canon_relative.cc;l=103;drc=9329f990b89052f1e7f82e0a1a4b298b72359263;bpv=0;bpt=1&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;DoIsRelativeURL()&lt;/code&gt;&lt;/a&gt; in &lt;code class=&quot;language-text&quot;&gt;url/url_canon_relative.cc&lt;/code&gt;,
that follow some logic to determine if the string is a relative url or absolute url.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// See IsRelativeURL in the header file for usage.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;typename&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CHAR&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;DoIsRelativeURL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; base&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                     &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; Parsed&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; base_parsed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                     &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; CHAR&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                     &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; url_len&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                     &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; is_base_hierarchical&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                     &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; is_relative&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                     Component&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; relative_component&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;is_relative &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// So we can default later to not relative.&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Trim whitespace and construct a new range for the substring.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; begin &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;TrimURL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;begin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;url_len&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;begin &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; url_len&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Empty URLs are relative, but do nothing.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;is_base_hierarchical&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// Don&apos;t allow relative URLs if the base scheme doesn&apos;t support it.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;relative_component &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Component&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;begin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;is_relative &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;ifdef&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;WIN32&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// We special case paths like &quot;C:\foo&quot; so they can link directly to the&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// file on Windows (IE compatibility). The security domain stuff should&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// prevent a link like this from actually being followed if its on a&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// web page.&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// We treat &quot;C:/foo&quot; as an absolute URL. We can go ahead and treat &quot;/c:/&quot;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// as relative, as this will just replace the path when the base scheme&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// is a file and the answer will still be correct.&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// We require strict backslashes when detecting UNC since two forward&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// slashes should be treated a a relative URL with a hostname.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;DoesBeginWindowsDriveSpec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; begin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; url_len&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;DoesBeginUNCPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; begin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; url_len&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;endif&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// WIN32&lt;/span&gt;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// See if we&apos;ve got a scheme, if not, we know this is a relative URL.&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// BUT, just because we have a scheme, doesn&apos;t make it absolute.&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// &quot;http:foo.html&quot; is a relative URL with path &quot;foo.html&quot;. If the scheme is&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// empty, we treat it as relative (&quot;:foo&quot;), like IE does.&lt;/span&gt;
  Component scheme&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; scheme_is_empty &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
      &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ExtractScheme&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; url_len&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;scheme&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; scheme&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;len &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;scheme_is_empty&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;begin&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;#&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// |url| is a bare fragment (e.g. &quot;#foo&quot;). This can be resolved against&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// any base. Fall-through.&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;is_base_hierarchical&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// Don&apos;t allow relative URLs if the base scheme doesn&apos;t support it.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;relative_component &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MakeRange&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;begin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; url_len&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;is_relative &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// If the scheme isn&apos;t valid, then it&apos;s relative.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IsValidScheme&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; scheme&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;begin&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;#&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
        base&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;FeatureList&lt;/span&gt;&lt;span class=&quot;token double-colon punctuation&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IsEnabled&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            kResolveBareFragmentWithColonOnNonHierarchical&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// |url| is a bare fragment (e.g. &quot;#foo:bar&quot;). This can be resolved&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// against any base. Fall-through.&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;is_base_hierarchical&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// Don&apos;t allow relative URLs if the base scheme doesn&apos;t support it.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;relative_component &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MakeRange&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;begin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; url_len&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;is_relative &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// If the scheme is not the same, then we can&apos;t count it as relative.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AreSchemesEqual&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;base&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; base_parsed&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;scheme&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; scheme&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// When the scheme that they both share is not hierarchical, treat the&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// incoming scheme as absolute (this way with the base of &quot;data:foo&quot;,&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// &quot;data:bar&quot; will be reported as absolute.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;is_base_hierarchical&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; colon_offset &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; scheme&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// If it&apos;s a filesystem URL, the only valid way to make it relative is not to&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// supply a scheme. There&apos;s no equivalent to e.g. http:index.html.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;CompareSchemeComponent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; scheme&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; kFileSystemScheme&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// ExtractScheme guarantees that the colon immediately follows what it&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// considers to be the scheme. CountConsecutiveSlashes will handle the&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// case where the begin offset is the end of the input.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; num_slashes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;CountConsecutiveSlashes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; colon_offset &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; url_len&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;num_slashes &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; num_slashes &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// No slashes means it&apos;s a relative path like &quot;http:foo.html&quot;. One slash&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// is an absolute path. &quot;http:/home/foo.html&quot;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;is_relative &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;relative_component &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MakeRange&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;colon_offset &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; url_len&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Two or more slashes after the scheme we treat as absolute.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Near the end of the function, the code is counting the number of consecutive slashes
(at the beginning of the substring, right after scheme colon offset, if any)
to determine if the url is a relative one. But it doesn’t mention whether
it’s slash or backslash. Hmmmmm.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/64c29728064f5ba5e489ee7eb8e5b90d/66632/ask-chatgpt-chromium-6.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABbklEQVQoz63R227TQBCAYb//g3ETgTDQpCVNbCdxfNiDveOzY/tHNSnqBQgVMdKnmR1p52LGs9JiXIdxLda1jOPAOPTv1vfdygvTim+h8BAJ20gIsp5Qjf/M258tH59y/L1i8xCvw4/5xCG7/cH0G/d+PuEpZajrmv8Ty8+BbS2MzjK6glEKBq2Ym5reaHqtGMqCNksYCsso7pfBlWvurWEe+nWkd0ktp2dF9OVC4Ec8bw5sN1u2/o7klHI5nEmihOQQk6eWUgZcNSDNjerOyct7ouoXvCA2RJFwPXfE15boWhElQhBbYlVzVkIcN4RHwX8M8XcBYVyS5gPBteSUClombAO2mvGUMXRVQ2daztF3DvvPXKJHmlqwRq+5MBqtMqrKMU83WGaY57Ve5tu6u9fw0lzTNC2tdDztvuJ/+kB43KJUTpbnaG1QSiEiaz2O4339b06xvFhWXpZrXCl0ZY+UFW3X//2W989vvfZ/AAuj/F+ii19eAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ask-chatgpt-chromium-6&quot;
        title=&quot;ask-chatgpt-chromium-6&quot;
        src=&quot;/static/64c29728064f5ba5e489ee7eb8e5b90d/f058b/ask-chatgpt-chromium-6.png&quot;
        srcset=&quot;/static/64c29728064f5ba5e489ee7eb8e5b90d/c26ae/ask-chatgpt-chromium-6.png 158w,
/static/64c29728064f5ba5e489ee7eb8e5b90d/6bdcf/ask-chatgpt-chromium-6.png 315w,
/static/64c29728064f5ba5e489ee7eb8e5b90d/f058b/ask-chatgpt-chromium-6.png 630w,
/static/64c29728064f5ba5e489ee7eb8e5b90d/40601/ask-chatgpt-chromium-6.png 945w,
/static/64c29728064f5ba5e489ee7eb8e5b90d/78612/ask-chatgpt-chromium-6.png 1260w,
/static/64c29728064f5ba5e489ee7eb8e5b90d/66632/ask-chatgpt-chromium-6.png 1504w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;A function &lt;a href=&quot;https://source.chromium.org/chromium/chromium/src/+/refs/heads/main:url/url_parse_internal.h;l=15;drc=991110a34dafb7233475cdfa91c3416d1e91b724;bpv=1;bpt=1&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;IsURLSlash()&lt;/code&gt;&lt;/a&gt;…?&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/323874d36260238920f40a5b09259048/985a9/ask-chatgpt-chromium-7.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABhUlEQVQoz4XRa2+bMBiGYf7/j6vWbu1yaKEhgYSDsQ0+YRLuKTTalqlTX+mSn+eLJb9OZO+opaNRnqpz9DYQ40gYA+Nv45dCCItEqIHvmeZhK3nYdDymms1xurO+KiPrY7w/y7/6YiJRvWWVNXxbHXjalDyuC16ylue0WTxtT6RHy0nPHNXlS4l1gb4fmIMjqo5JK0JbE5UkannL3Y1k7FrOpifKjlGKpU+9WvLZDiTGeqpaoJSm1z3aDYhB0Q5ycc3SajqjaPoOO3rmGS6X+VPLhUIIfOfwrcVZw3yZ+Hzm//gzSW88b7ngkHXk64rd9sTqxyubl4y35z27nyXpKifPKoq8pdwLjqWi2NUcsmrpjRzpzIwYLiSDDbwfWurSUu0MRSEpG8mhEuT7llY4amXQbsJFFibMNx95uPIfEuM8TdNgG4M9GZqiJk1f2b/v0IVCV5K+VZxtxFuLd+af59/PssPjqSaGyBTOWOcw1uBdYPIT0U+MLhLdRPABH8LyKfM8f+oX5TX9n6dsyp4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ask-chatgpt-chromium-7&quot;
        title=&quot;ask-chatgpt-chromium-7&quot;
        src=&quot;/static/323874d36260238920f40a5b09259048/f058b/ask-chatgpt-chromium-7.png&quot;
        srcset=&quot;/static/323874d36260238920f40a5b09259048/c26ae/ask-chatgpt-chromium-7.png 158w,
/static/323874d36260238920f40a5b09259048/6bdcf/ask-chatgpt-chromium-7.png 315w,
/static/323874d36260238920f40a5b09259048/f058b/ask-chatgpt-chromium-7.png 630w,
/static/323874d36260238920f40a5b09259048/40601/ask-chatgpt-chromium-7.png 945w,
/static/323874d36260238920f40a5b09259048/78612/ask-chatgpt-chromium-7.png 1260w,
/static/323874d36260238920f40a5b09259048/985a9/ask-chatgpt-chromium-7.png 1512w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Omg, it treats backslash the same as normal slash, for IE compatibility!&lt;/p&gt;
&lt;p&gt;Which means, the string &lt;code class=&quot;language-text&quot;&gt;\\abc.com&lt;/code&gt; could also cause domain change in redirect.&lt;/p&gt;
&lt;h1 id=&quot;what-ive-learnt&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#what-ive-learnt&quot; aria-label=&quot;what ive learnt permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What I’ve learnt&lt;/h1&gt;
&lt;p&gt;First of all, &lt;strong&gt;the browser redirect url construction is complicated, and not standardized&lt;/strong&gt;.
We must rely on browser API to produce the exact result.&lt;/p&gt;
&lt;p&gt;Second, ChatGPT’s performance is extraordinary!
Although it could not give us the correct answer like a miracle machine,
&lt;strong&gt;the guidance from ChatGPT in reading source code significantly reduced the learning barrier&lt;/strong&gt;. It’s like
getting help from a chromium developer, pointing directions for you to understand the codebase.
If you feed it a function source code, it can do a very good summary about what the code is doing.
Can’t imagine how far would it get after a year or two.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Multi threading in node-js]]></title><description><![CDATA[Recently I happened to write some nodejs scripts to do some simple static analysis with babel.
But the program took quite some time to…]]></description><link>https://cccv.blog/2022-06-25-multi-threading-in-node-js/</link><guid isPermaLink="false">https://cccv.blog/2022-06-25-multi-threading-in-node-js/</guid><pubDate>Sat, 25 Jun 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Recently I happened to write some nodejs scripts to do some simple static analysis with babel.
But the program took quite some time to finish. Time for optimization.&lt;/p&gt;
&lt;p&gt;We always say “nodejs is single-threaded”. And we seldom use nodejs to run code with multithreading (maybe it’s just me).
Indeed nodejs multithreading support have been here for a while! Let’s try to make use of the threads to distribute the loads.&lt;/p&gt;
&lt;p&gt;As early as node &lt;code class=&quot;language-text&quot;&gt;v10.5.0&lt;/code&gt; (2018), the experimental feature &lt;code class=&quot;language-text&quot;&gt;Worker&lt;/code&gt; constructor was introduced for spawning workers to utilize the other cores of cpu.
However the interface of it had been changing until &lt;code class=&quot;language-text&quot;&gt;v12.17.0&lt;/code&gt; (2020). (&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Worker/Worker&quot;&gt;mdn&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e21c0ea67b5d9ad852af546e88d3cd44/b2b2c/worker-constructor-nodejs-mdn.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 86.70886075949367%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAABmUlEQVQ4y61Ti27CMAzs/38lEmi06Stpm+YB9KYzuCsMEJNmyYrrxBdffC0ulwuWZRFnfDqdZM05I4Qg8fl8XvcYxxhlnzFzjJ1zcqYgkNoWmNb3vRTQ5nlGWZboug4pJQExxqBpmrvaQos1wa705qqqpBsaOzgej5Jr21Yu4zdBabyENcWWMo0H6rqWlYXWWfnWHFeCsVN2fCxLjOOItmkwe4/ika61Fh076Ho4a+Enj2EYrrm+l30CcCX44AZY62Bai9FHFIf9HrvdTmgSMKaEmBNCiuJzCoi3mJ5yQspZfI4BIQUMMeNQ92jciIK382YBvCwC5uMsTrAx+itYvgGe8uo+XQFdiPgyFeq2+aFM46OOg8PgzDqMvxjHsA5F33GaJlTGyDRVMvq+W1mpP+Z/6ZCA1JbKgw/PWKes061vE9czXF8CstDculT5fEZ5uQckRed6hNlik35K+9GfAmqHZVkJLapf32oL+qyzt4B1bda321L+GFATSnkam7Wrf6Jcyo9PLVLw9I+H8qgl773I5h3lV07ZfAO9HS/WevasFgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;worker-constructor-nodejs-mdn&quot;
        title=&quot;worker-constructor-nodejs-mdn&quot;
        src=&quot;/static/e21c0ea67b5d9ad852af546e88d3cd44/f058b/worker-constructor-nodejs-mdn.png&quot;
        srcset=&quot;/static/e21c0ea67b5d9ad852af546e88d3cd44/c26ae/worker-constructor-nodejs-mdn.png 158w,
/static/e21c0ea67b5d9ad852af546e88d3cd44/6bdcf/worker-constructor-nodejs-mdn.png 315w,
/static/e21c0ea67b5d9ad852af546e88d3cd44/f058b/worker-constructor-nodejs-mdn.png 630w,
/static/e21c0ea67b5d9ad852af546e88d3cd44/40601/worker-constructor-nodejs-mdn.png 945w,
/static/e21c0ea67b5d9ad852af546e88d3cd44/78612/worker-constructor-nodejs-mdn.png 1260w,
/static/e21c0ea67b5d9ad852af546e88d3cd44/b2b2c/worker-constructor-nodejs-mdn.png 1708w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;nodejs-worker_threads-module&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#nodejs-worker_threads-module&quot; aria-label=&quot;nodejs worker_threads module permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Nodejs &lt;code class=&quot;language-text&quot;&gt;worker_threads&lt;/code&gt; module&lt;/h2&gt;
&lt;p&gt;This is an example of the main thread spawning a worker.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// index.ts&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Worker &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;worker_threads&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// spawn a worker&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; worker &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Worker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;./worker&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// send data to worker&lt;/span&gt;
worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;postMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;some message from main thread&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;postMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;john&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;postMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;b&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;c&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// worker.ts&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; parentPort &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;worker_threads&quot;&lt;/span&gt;

parentPort&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;message&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;worker received message:&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;what-kinds-of-data-can-we-send-to-workers&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#what-kinds-of-data-can-we-send-to-workers&quot; aria-label=&quot;what kinds of data can we send to workers permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;What kinds of data can we send to workers?&lt;/h3&gt;
&lt;p&gt;Usually when doing multithreading, we have to be very careful in sharing data between threads.
Otherwise weird bugs and race condition would mess up your program.&lt;/p&gt;
&lt;p&gt;So in nodejs, there is some restriction in what kinds of data can be sent to workers via &lt;a href=&quot;https://nodejs.org/api/worker_threads.html#portpostmessagevalue-transferlist&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;postMessage&lt;/code&gt;&lt;/a&gt;.
All values that are compatible with &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm&quot;&gt;HTML structured clone algorithm&lt;/a&gt; are allowed.
It includes a wide variety of complex objects, like &lt;code class=&quot;language-text&quot;&gt;Array&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Date&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Map&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Set&lt;/code&gt;, objects with circular reference, etc.&lt;/p&gt;
&lt;p&gt;While values like &lt;strong&gt;functions&lt;/strong&gt;, DOM nodes and those “with context / metadata” are not supported, and would cause &lt;code class=&quot;language-text&quot;&gt;DataCloneError&lt;/code&gt; exception.&lt;/p&gt;
&lt;h3 id=&quot;how-are-values-passed-down-to-workers&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#how-are-values-passed-down-to-workers&quot; aria-label=&quot;how are values passed down to workers permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;How are values passed down to workers?&lt;/h3&gt;
&lt;p&gt;The values are cloned to the workers. So the workers can freely modify the values!&lt;/p&gt;
&lt;p&gt;But there is an exception. &lt;code class=&quot;language-text&quot;&gt;postMessage&lt;/code&gt; supports second function param &lt;code class=&quot;language-text&quot;&gt;transferList&lt;/code&gt;. which
is a list only allows &lt;code class=&quot;language-text&quot;&gt;ArrayBuffer&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;MessagePort&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;FileHandle&lt;/code&gt; values.
Once the message is sent, the listed values are not allowed to be used by the sending side.
It is for some special use, so we won’t go further.&lt;/p&gt;
&lt;h3 id=&quot;limitation-code-execution-isolation&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#limitation-code-execution-isolation&quot; aria-label=&quot;limitation code execution isolation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Limitation: code execution isolation&lt;/h3&gt;
&lt;p&gt;From the API design of &lt;code class=&quot;language-text&quot;&gt;worker_threads&lt;/code&gt;, we can see that we can’t share scope of the main thread when execute code in worker.
If we want to pass data to workers, we have to do it explicitly, either with &lt;code class=&quot;language-text&quot;&gt;postMessage&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;setEnvironmentData&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We cannot have this kind of abstraction of multithreading:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// imaginary abstraction of defining multithreading jobs&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; results &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; superStream&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fromValues&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setMaxThreads&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;runInThreads&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token comment&quot;&gt;// expensiveComputation() is an ordinary function&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;expensiveComputation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; result
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;main thread got results from workers:&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; results&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;isolated-import-in-worker&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#isolated-import-in-worker&quot; aria-label=&quot;isolated import in worker permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Isolated import in worker&lt;/h3&gt;
&lt;p&gt;For the sake of thread safety, all data sharing between threads must be explicit.
The import of a file in a worker is isolated from the import of the same file in the main thread / other workers.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// mutableObj.ts&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; count&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// worker.ts&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; parentPort &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;worker_threads&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; obj &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./mutableObj&quot;&lt;/span&gt;

parentPort&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;postMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;obj&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// index.ts&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Worker &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;worker_threads&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; obj &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./mutableObj&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// mutate the value from the import&lt;/span&gt;
obj&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;count &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// spawn a worker&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; worker &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Worker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;./worker&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;mssage&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; objFromWorker &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  assert&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;deepStrictEqual&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;objFromWorker&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; count&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;threadsjs-library&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#threadsjs-library&quot; aria-label=&quot;threadsjs library permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;threads.js&lt;/code&gt; library&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/245b892e37a1600a8452fc6e9659f711/e7aec/threads-js-logo.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 13.924050632911392%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhklEQVQI1y3OOw6BYRSE4b+1AYUd6EQhCk9EbMA1WnGJhpBQWIA9aNRWgAqdQisanaXIF2eamWROzrwZRiiigDlaqKGOCcrooRpewRQlDJFDPrpuhj3WUZywwxdnvHDFBwc8cMETR7zR8dcN9/RwEzQpN2K5HaSDyIvwFfrYoollosI47mc/Zk5DWo0y2YkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;threads.js&quot;
        title=&quot;threads.js&quot;
        src=&quot;/static/245b892e37a1600a8452fc6e9659f711/f058b/threads-js-logo.png&quot;
        srcset=&quot;/static/245b892e37a1600a8452fc6e9659f711/c26ae/threads-js-logo.png 158w,
/static/245b892e37a1600a8452fc6e9659f711/6bdcf/threads-js-logo.png 315w,
/static/245b892e37a1600a8452fc6e9659f711/f058b/threads-js-logo.png 630w,
/static/245b892e37a1600a8452fc6e9659f711/40601/threads-js-logo.png 945w,
/static/245b892e37a1600a8452fc6e9659f711/78612/threads-js-logo.png 1260w,
/static/245b892e37a1600a8452fc6e9659f711/e7aec/threads-js-logo.png 1726w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The library &lt;a href=&quot;https://github.com/andywer/threads.js/&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;threads.js&lt;/code&gt;&lt;/a&gt;, created in 2019, provides a higher level abstraction for doing multithreading.
It also supports multi platforms of nodejs, browser and electron!&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// index.ts&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; spawn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Thread&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Worker &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;threads&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; worker &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;spawn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Worker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;./worker&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;main thread got result from worker:&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// worker.ts&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; expose &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;threads/worker&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;fib&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;n&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;n &lt;span class=&quot;token operator&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;n &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fib&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;n &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;expose&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; fib &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;thread-pool&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#thread-pool&quot; aria-label=&quot;thread pool permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Thread pool&lt;/h3&gt;
&lt;p&gt;Most likely you don’t want to create too many workers than the actual cpu cores you have,
otherwise the context switching overhead would reduce the overall performance.
You will need to maintain a pool of workers to do your jobs, which is what &lt;code class=&quot;language-text&quot;&gt;threads.js&lt;/code&gt; supports!&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ts&quot;&gt;&lt;pre class=&quot;language-ts&quot;&gt;&lt;code class=&quot;language-ts&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// index.ts&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; spawn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Pool&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Worker &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;threads&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; cpus &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;os&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; computationParams &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; results &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; poolSize &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cpus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; pool &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Pool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;spawn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Worker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;./worker&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; poolSize&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; param &lt;span class=&quot;token keyword&quot;&gt;of&lt;/span&gt; computationParams&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    pool&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;worker&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; worker&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;expensiveComputation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;param&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        results&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; pool&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;completed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; pool&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;terminate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;main thread got results from workers:&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; results&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;conclusion&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;The basic use of worker is simple enough. As for my little nodejs program, the utilization of the extra cpu cores reduced the execution time from ~2mins to 38s. Sweet.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Switching applications with keyboard shortcut on macOS]]></title><description><![CDATA[At some point, simple “Cmd + Tab” is not fast and precise enough to switch between applications. Using “Cmd + Space” to search for…]]></description><link>https://cccv.blog/2021-10-02-switching-applications-with-keyboard-shortcut-on-macos/</link><guid isPermaLink="false">https://cccv.blog/2021-10-02-switching-applications-with-keyboard-shortcut-on-macos/</guid><pubDate>Sat, 02 Oct 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;At some point, simple “Cmd + Tab” is not fast and precise enough to switch between applications. Using “Cmd + Space” to search for application is ok, but too slow for frequently used applications.&lt;/p&gt;
&lt;p&gt;Let’s setup a few custom shortcuts like &lt;code class=&quot;language-text&quot;&gt;caps+E&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;caps+S&lt;/code&gt; switch between your most used applications like &lt;strong&gt;VS code&lt;/strong&gt;, &lt;strong&gt;Slack&lt;/strong&gt; and &lt;strong&gt;Chrome&lt;/strong&gt; (on macOS)!&lt;/p&gt;
&lt;h2 id=&quot;1-karabiner-elements---key-combination-mapping&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#1-karabiner-elements---key-combination-mapping&quot; aria-label=&quot;1 karabiner elements   key combination mapping permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1. Karabiner-Elements - key combination mapping&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://karabiner-elements.pqrs.org&quot;&gt;Karabiner&lt;/a&gt; is a popular keyboard customier for macOS. We’re going to use it to change the key &lt;code class=&quot;language-text&quot;&gt;caps&lt;/code&gt; to &lt;code class=&quot;language-text&quot;&gt;shift+cmd+option+ctrl&lt;/code&gt; (“hyper key”), because we&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;don’t want to use too-simple shortcuts that might have been used by other applications already&lt;/li&gt;
&lt;li&gt;don’t want to press the 4 keys at once&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Follow the &lt;a href=&quot;https://karabiner-elements.pqrs.org/docs/getting-started/installation/&quot;&gt;instructions from the official website&lt;/a&gt; to install application, and don’t miss all the security config changes required.&lt;/p&gt;
&lt;p&gt;After Karabiner is properly set up, go to &lt;a href=&quot;https://ke-complex-modifications.pqrs.org/#Jesse_Tutorial_Hyper_Plus_Others&quot;&gt;KE-complex_modifications&lt;/a&gt; to import this &lt;code class=&quot;language-text&quot;&gt;CAPS_LOCK to Hyper/Escape&lt;/code&gt; rule set. Actually only the &lt;code class=&quot;language-text&quot;&gt;CAPS_LOCK to HYPER (SHIFT+COMMAND+OPTION+CONTROL) or ESCAPE (If Alone)&lt;/code&gt; rule is needed. (btw I’ve been long used to have &lt;code class=&quot;language-text&quot;&gt;Caps&lt;/code&gt; replaced with &lt;code class=&quot;language-text&quot;&gt;Esc&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;I only keep this rule after import.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/864db9b5714cbb3a2ae2583cb66900df/49853/karabiner-mapping.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 61.39240506329114%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB20lEQVQoz6XSz27aMBwH8N/KaQQhTZu0J9it1257rb3ADs2kvcYO3CcRKYehrYfuz6EaISrdICZxHEOASFR1gGCHEE82lSga1Tbt8JHt/H7+yk4Cz+D46Oqi9arrdd4ib3Da6/VMz/NMz+ub3Z8D8+zbpfnp/ML8+Pm72W63b2tbCCHlFCH0pt/vv261Wk+hclSpYoxnEY1kGIbS930ZhkSSEMuuR+T7r4l8dzaTX9yRjIiqB7oHY6xFUaQRQqRt2y/AMAwjCAKMEJJBEOTD4bCglBZRFBXxkBYIjwqnnxRUreO4SJJkT0TImlK6wRgvLcs6gVqtZvi+T2bX13I+n2/SNC0VxljJ0rScz9NytWT62WKxKEWebwlR5nmu+24YU7fjzWbzBOr1ug5kaSrzPN9wIaS4Q605381Xq9UeFZplmQ60LOv5LpAxtWGzbeRyN97Bf8c5LxfL5eFAoQL54Y334UKUy/sC90/4N1aHTzgYDDBj+h2uuRDFn4hbep7n6yzLSoxxpj9KtVo1CCEJpVSOx2NtNBrJOI4PUrXpdConk4meq3Eynep/0bbtlwAAD13X/eC6Lup0OpeO41z9o67jOD9c1203Go1jFfgAAOoA8AQAHv+HRwBQ+QVPpvCaYihr7gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;karabiner-rule&quot;
        title=&quot;karabiner-rule&quot;
        src=&quot;/static/864db9b5714cbb3a2ae2583cb66900df/f058b/karabiner-mapping.png&quot;
        srcset=&quot;/static/864db9b5714cbb3a2ae2583cb66900df/c26ae/karabiner-mapping.png 158w,
/static/864db9b5714cbb3a2ae2583cb66900df/6bdcf/karabiner-mapping.png 315w,
/static/864db9b5714cbb3a2ae2583cb66900df/f058b/karabiner-mapping.png 630w,
/static/864db9b5714cbb3a2ae2583cb66900df/40601/karabiner-mapping.png 945w,
/static/864db9b5714cbb3a2ae2583cb66900df/78612/karabiner-mapping.png 1260w,
/static/864db9b5714cbb3a2ae2583cb66900df/49853/karabiner-mapping.png 2224w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;2-hammerspoon---define-the-action-of-shortcut&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#2-hammerspoon---define-the-action-of-shortcut&quot; aria-label=&quot;2 hammerspoon   define the action of shortcut permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;2. Hammerspoon - define the action of shortcut&lt;/h2&gt;
&lt;p&gt;Now we need &lt;a href=&quot;https://www.hammerspoon.org/&quot;&gt;Hammerspoon&lt;/a&gt; to define what will be executed after pressing our hyper key shortcuts. &lt;a href=&quot;https://www.hammerspoon.org/&quot;&gt;Follow the instruction&lt;/a&gt; and go to github release page to download and install it.&lt;/p&gt;
&lt;p&gt;The final step is to create your &lt;code class=&quot;language-text&quot;&gt;~/.hammerspoon/init.lua&lt;/code&gt;. It doesn’t matter if you don’t know how to write Lua yet. Here is my &lt;code class=&quot;language-text&quot;&gt;init.lua&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;lua&quot;&gt;&lt;pre class=&quot;language-lua&quot;&gt;&lt;code class=&quot;language-lua&quot;&gt;hyperKey &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;shift&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;control&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;option&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;command&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- reload config&lt;/span&gt;
hs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hotkey&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hyperKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;r&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  hs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;reload&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

appShortcutMap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Google Chrome&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  e &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Visual Studio Code&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  s &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Slack&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  t &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;iTerm&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; k&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; v &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pairs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appShortcutMap&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  hs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hotkey&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;bind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;hyperKey&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; k&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    hs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;application&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;launchOrFocus&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- if hs.application.get(v):isFrontmost() then&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;--   hs.application.get(v):hide()&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- else&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;--   hs.application.launchOrFocus(v)&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;-- end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I’ve set up a few &lt;code class=&quot;language-text&quot;&gt;Caps+?&lt;/code&gt; shortcuts for my frequently used applications. You can change the mapping as you like.&lt;/p&gt;
&lt;p&gt;After updating the script, you have to reload it.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/adba03b4a698460a826f7855bdd5f370/669eb/hammerspoon-console.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 93.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAADKElEQVQ4y6WTXW/bVBjHzwYCzQgJvgy3fAouFok7QFzwBbiAC1SpTVUIr6qEtK0EonVQmm4N7UQvCtIAbbHrOFVst02dNE2a5sV2Ejt2bJ9z/sjulo0yYBWP9PNzju3np+c8lsl2r0ne/eD9yx99+vWVhQ8zwnx6Trh27brw8cK8kL+5IPzw/S1hefmWkM1mhVwuJywuLgqzs7PCfHpeSKfTCZlMRpiZmXmeMUYIGh1yb3nl9bb8i/rH4a+lqmGUDvb3FcMwlN3KgVIsFhVRFBVZlpOsqqpSq9WS54ZhlAzD2KnVatVSqfQeAELiy81cLrWnadD396AoCn7/7R5EqYxv8xqUcgWaqkJ9iKZq0DUdmqZN0XUd29vbn0+FS0tLqaIkQZJ3ImlHoveLD6gk79CiJNOKplJN16iqqVRVz6g8SaUSxNKtra1PpsL1jULKPOnBOjxlVr3L7XoXVq0Du96BZXRgH/cwbFtJto/7GJ5aCaOuzX3fp67rQpKkzFSYv7OWGvZsBP0xC6wxn5hjxAS2h3DoI7DGiEYTsICCeiGoHyFykj0HQMMwhCiKj4V3NtdTZr0De/eE2WqbD/Y6sHZbCJ0JRoc92NopRkYfttrGQD9NsnNkIhh4iTAIgvPCQiK0lBazK20eF1nlFvyeA/fYht934XVGMJUmnLoJUz5O7rsNiwe2R8MohFh8Unj3TGjKTWaVWzzuIC6KO3wUE2uMvtjAsNpF70E96dIsNbnfcWgYRX8V3t5YT1nNHoZ7XTasdrlTMzHc7yJyg2SOdBKBBhH8rhMfE35nlOSJ6XI2if4+w9X8air+UgAYPwtwxhFnRhk4Y/iHePoMV1fPCcGTN+PVtJLzp/HfQvZI+QywfxN63jgRPjzGRaA0OjfDtbX81Z45wMCZRPbIpxdh4PiBNXBRLIqPf73NzbtvqtUTlLQj7OoNlPWjZ6SBslZH5eAE98XSV1Ph3Nzsaz9tbl1fyRdu/LhWWLoIK/n1G4WNn7/7Jpt9IxF++cVnlwghLxBCXiKEvEoIeeWCxDUvE0JefOvtdy4Tzx2Rdrt1CcBz/4exN4kd5E+V1cXzHnvJmAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;hammerspoon-console&quot;
        title=&quot;hammerspoon-console&quot;
        src=&quot;/static/adba03b4a698460a826f7855bdd5f370/f058b/hammerspoon-console.png&quot;
        srcset=&quot;/static/adba03b4a698460a826f7855bdd5f370/c26ae/hammerspoon-console.png 158w,
/static/adba03b4a698460a826f7855bdd5f370/6bdcf/hammerspoon-console.png 315w,
/static/adba03b4a698460a826f7855bdd5f370/f058b/hammerspoon-console.png 630w,
/static/adba03b4a698460a826f7855bdd5f370/40601/hammerspoon-console.png 945w,
/static/adba03b4a698460a826f7855bdd5f370/669eb/hammerspoon-console.png 1244w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;If you have alrady ran the script, and are going to further modify it, the &lt;code class=&quot;language-text&quot;&gt;Caps+R&lt;/code&gt; shortcut should have registered to reload the config of Hammerspoon. You can use it instead of going to the console and click “Reload config”.&lt;/p&gt;
&lt;h2 id=&quot;3-profit&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#3-profit&quot; aria-label=&quot;3 profit permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;3. Profit&lt;/h2&gt;
&lt;p&gt;It takes some time to suppress the urge to press &lt;code class=&quot;language-text&quot;&gt;Cmd+Tab&lt;/code&gt;, and use the new shortcuts. But once you get used it, it’s much faster to switch between applications.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Amazing SQLite]]></title><description><![CDATA[With the great power and simplicity, SQLite has been underrated compared to other SQL databases like MySQL, PostreSQL, etc. Do you know…]]></description><link>https://cccv.blog/2021-09-29-amazing-sqlite/</link><guid isPermaLink="false">https://cccv.blog/2021-09-29-amazing-sqlite/</guid><pubDate>Wed, 29 Sep 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7cc3d43248b5f361f3c9566fa3f6b00f/c1b63/sqlite.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47.46835443037975%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCElEQVQoz41SUUiTURT+/jWTbG6LSiMiLciiiGq0h90zMwYNlLRAO8dZjj2ED0FFgdkytj99iAiEgnoLFr34IBFBRD30kpj0b7r2IKQ9hPYiahT0oL7c+P+NDXvqwsflnMv5znfPd9A59r2z/+PS7OCnlVxyfCmf+vw7f+XNt6w7klhEqGu6TpJuEAMk+K/DL+fNgfFlnZr8qQcnlvXQ1B8dvPVEI9A+bzTHCq5wd1WJ0HBIFdswoATlmKTSMPJ87nbs1YLufb2wmni7uH72maURjk0jdOEXSNLFInGXi4qEFdA/OP505s7pzJyOZGbXo6M/9KHk6BpOdkwY4e4cSBpA4imp2QWSGih2Q3F9RVmZzHDuvQ/yyQMjBd00Ulg7+GhG++MPVxDsyBnNPZdB0gIl20AcBUkjSIJQ3ArFPU4TxfZb9QaFPjN7129mtd+0Vv3DeV0df/wVh6ltz3vtAslNKD4P4qulL9uK70NJtDQKAvFFEDeCuBXETfCmrWvetKW9aWvVd29Ke/rfjdUOfMCmtht+kByBkktQ0g4lDVB8DMTnQNwHks1OniQBxaFijnfaCj0+Mxvwpa0T/uEvgS19maMAXGiJ14BkN4iLa6P4DEiug3griPc7xYp3gKQeSrZDsa2+Fj7TskkdeFOTqHuhUdU1ZOBU78ahO8bwPsekcq5kjKqsz1/LCsbU2rjvSgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;sqlite&quot;
        title=&quot;sqlite&quot;
        src=&quot;/static/7cc3d43248b5f361f3c9566fa3f6b00f/f058b/sqlite.png&quot;
        srcset=&quot;/static/7cc3d43248b5f361f3c9566fa3f6b00f/c26ae/sqlite.png 158w,
/static/7cc3d43248b5f361f3c9566fa3f6b00f/6bdcf/sqlite.png 315w,
/static/7cc3d43248b5f361f3c9566fa3f6b00f/f058b/sqlite.png 630w,
/static/7cc3d43248b5f361f3c9566fa3f6b00f/40601/sqlite.png 945w,
/static/7cc3d43248b5f361f3c9566fa3f6b00f/c1b63/sqlite.png 1200w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;With the great power and simplicity, SQLite has been underrated compared to other SQL databases like MySQL, PostreSQL, etc. Do you know SQLite is &lt;a href=&quot;https://www.sqlite.org/mostdeployed.html&quot;&gt;the most used database engine in the world&lt;/a&gt;?&lt;/p&gt;
&lt;p&gt;SQLite is outstanding on its ways, and not “just another backend database engine”. Here are some fascinating integrations with SQLite:&lt;/p&gt;
&lt;h3 id=&quot;running-sqlite-on-browser&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#running-sqlite-on-browser&quot; aria-label=&quot;running sqlite on browser permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Running SQLite on browser&lt;/h3&gt;
&lt;p&gt;SQLite has been ported to the browser via webassemply by &lt;a href=&quot;https://github.com/sql-js/sql.js&quot;&gt;sql.js&lt;/a&gt;! Try SQLite in your browser on &lt;a href=&quot;https://sqlime.org/&quot;&gt;SQLime&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id=&quot;and-its-way-faster-than-indexeddb---on-indexeddb&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#and-its-way-faster-than-indexeddb---on-indexeddb&quot; aria-label=&quot;and its way faster than indexeddb   on indexeddb permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;And it’s way faster than IndexedDB - on IndexedDB&lt;/h4&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;sql.js&lt;/code&gt; keeps the data in memory. So it make sense to be faster than IndexedDB. However, if we plug IndexedDB as the storage layer to &lt;code class=&quot;language-text&quot;&gt;sql.js&lt;/code&gt;, it can still be 10x faster than using plain IndexedDB. That’s absurd. Therefore &lt;a href=&quot;https://github.com/jlongster/absurd-sql&quot;&gt;absurd-sql&lt;/a&gt; was given its name.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/25f45db69aded023646687fefa9b7814/c929c/indexeddb-vs-sqlite-on-indexeddb.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.0253164556962%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABjElEQVQoz4WSW2/UMBCF8//FK688ICFUEBcJBJW4qNLywC+A0tKqQm1pks3GqZM4l7E/NM5mS7dqd6RjR2P75MyZSay1ZFlGWZYRRVHgnMN7D0EgBHwAzxSaF5E70PwwDCRd16GkdV1HVFUVDzRSIxTmmrFc4fKMoixp25a7EeKqxEkIIV5K0/TmWFV5j6lHKlvT22ucKSlNhQrQsw1Und4HxnEk0WUm0P1/3Bfbd0LfEboOET8pVM9U4Uw8Q9Z++TVmrzYYhlisW3zF7b9DgETL7fs+YvvvOyES37hPH2jf7MWykzzPY2e1w9sKd2LoJ4WfP9K+fXFboXZ4J+FcsvoONC+fMV5e4L4d3ChUEvXGGHPL9Ac6svlsHj9CTo+R7wvcq+cToXZ5niGdP1Ubd+cY1Fvn6LUK1+L+nDGIYL/s4xrH8ukT6pPf/D1YYN+/nkqWtbFKolBPNZdeXdF3HXmWYo1htVySHh9RNw3nP39Q25rTX0dxPzw8ocqzOBUbwl2hjctXqwftEBn5B2djpFN0zncmAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;sqlite on indexeddb vs indexeddb&quot;
        title=&quot;sqlite on indexeddb vs indexeddb&quot;
        src=&quot;/static/25f45db69aded023646687fefa9b7814/f058b/indexeddb-vs-sqlite-on-indexeddb.png&quot;
        srcset=&quot;/static/25f45db69aded023646687fefa9b7814/c26ae/indexeddb-vs-sqlite-on-indexeddb.png 158w,
/static/25f45db69aded023646687fefa9b7814/6bdcf/indexeddb-vs-sqlite-on-indexeddb.png 315w,
/static/25f45db69aded023646687fefa9b7814/f058b/indexeddb-vs-sqlite-on-indexeddb.png 630w,
/static/25f45db69aded023646687fefa9b7814/40601/indexeddb-vs-sqlite-on-indexeddb.png 945w,
/static/25f45db69aded023646687fefa9b7814/c929c/indexeddb-vs-sqlite-on-indexeddb.png 1218w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;static-sqlite-server&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#static-sqlite-server&quot; aria-label=&quot;static sqlite server permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Static SQLite server&lt;/h3&gt;
&lt;p&gt;Thanks to the design of SQLite that having an &lt;a href=&quot;https://www.sqlite.org/vfs.html&quot;&gt;abstract layer (VFS) for OS interface&lt;/a&gt;, porting SQLite to another OS only means implementing the thin layer with file-system-specific operations.&lt;/p&gt;
&lt;p&gt;What if we use http-request for SQLite’s virtual file system to access database data? Then we can create static website with SQLite as database, without fetching the whole database to the client at once!&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/phiresky/sql.js-httpvfs&quot;&gt;sql.js-httpvfs&lt;/a&gt; builds on top of &lt;code class=&quot;language-text&quot;&gt;sql.js&lt;/code&gt; and implements a read-only  HTTP-Range-request based virtual file system for SQLite, to make things possible such as this gigantic &lt;a href=&quot;http://static.wiki/&quot;&gt;static wikipedia with 43GB SQLite data&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9560660bd29f04a0222934e96ddbe3d4/2215f/static-wiki.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 46.835443037974684%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABBklEQVQoz5WS226DMAyGef/XmrSbXXaTKg0ICSgUSihQKIcc/ipU6VgBTbMU/U4cf7aVeNgwY8ysWhvw4obzZZhV1MMz7u68mrcJMwZKG1SdxNuhwMexxPuXwCepMalHbFl4F7iszEULnglMUkFqQOoHSFwlbqPe7dR7DThtB426k7j2Gu1o0A4G3WjQ9Bpq5tmcNdRbbpyvlAKlFJQyhCHBt+8jiiL4vo8gCNA0zWpk5//q0B3aBAtgjIFzPsPjOAYhBEmSgPMUSulVh1ZnYN/3OJ1SZKJBXk3gWYkwCJ5QC7PKGAVLS5CkRFp0yKsRaX5BUZx/gOuX2v4Of9nuyMsx/rNch3e6WL6GTuS3TwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;static wiki&quot;
        title=&quot;static wiki&quot;
        src=&quot;/static/9560660bd29f04a0222934e96ddbe3d4/f058b/static-wiki.png&quot;
        srcset=&quot;/static/9560660bd29f04a0222934e96ddbe3d4/c26ae/static-wiki.png 158w,
/static/9560660bd29f04a0222934e96ddbe3d4/6bdcf/static-wiki.png 315w,
/static/9560660bd29f04a0222934e96ddbe3d4/f058b/static-wiki.png 630w,
/static/9560660bd29f04a0222934e96ddbe3d4/40601/static-wiki.png 945w,
/static/9560660bd29f04a0222934e96ddbe3d4/78612/static-wiki.png 1260w,
/static/9560660bd29f04a0222934e96ddbe3d4/2215f/static-wiki.png 1548w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;backend-dead-simple-db-backups-and-cheap&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#backend-dead-simple-db-backups-and-cheap&quot; aria-label=&quot;backend dead simple db backups and cheap permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Backend: dead simple db backups, and cheap&lt;/h3&gt;
&lt;p&gt;SQLite’s database is just a file. Why not backup the database like a file? &lt;a href=&quot;https://litestream.io/&quot;&gt;litestream&lt;/a&gt; can setup a deamon or docker container to constantly backup the database for you, on popular storage service like S3.&lt;/p&gt;
&lt;h2 id=&quot;supercharged-static-websites&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#supercharged-static-websites&quot; aria-label=&quot;supercharged static websites permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Supercharged static websites&lt;/h2&gt;
&lt;p&gt;To me, the most interesting thing about SQLite is the use of it on frontend. The possibilities of static website are greatly enhanced.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Learning Haskell as a JS developer]]></title><description><![CDATA[As a developer using primarily JavaScript for years, my first attempt to learn Haskell was to skip reading bunch of documentation and just…]]></description><link>https://cccv.blog/2021-09-07-learning-haskell-as-a-js-developer/</link><guid isPermaLink="false">https://cccv.blog/2021-09-07-learning-haskell-as-a-js-developer/</guid><pubDate>Tue, 07 Sep 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;As a developer using primarily JavaScript for years, my first attempt to learn Haskell was to skip reading bunch of documentation and just get started with intuition. The attempt failed miserabily.&lt;/p&gt;
&lt;h2 id=&quot;setup&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#setup&quot; aria-label=&quot;setup permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Setup&lt;/h2&gt;
&lt;p&gt;First, you need &lt;code class=&quot;language-text&quot;&gt;ghc&lt;/code&gt; at least to compile Haskell code. How would you install that? The Haskell official website provided me the &lt;strong&gt;non-optimal&lt;/strong&gt; way to manage the &lt;code class=&quot;language-text&quot;&gt;ghc&lt;/code&gt; installation, which was to install a specific &lt;code class=&quot;language-text&quot;&gt;ghc&lt;/code&gt; version into the system. It was not optimal because you can indeed use &lt;code class=&quot;language-text&quot;&gt;stack&lt;/code&gt; to bootstrap your project, and manage the &lt;code class=&quot;language-text&quot;&gt;ghc&lt;/code&gt; version for you.&lt;/p&gt;
&lt;p&gt;However, it’s better now that a more comprehensive tool &lt;code class=&quot;language-text&quot;&gt;GHCup&lt;/code&gt; &lt;a href=&quot;https://www.haskell.org/downloads/#linux-mac-freebsd&quot;&gt;is available on the officla Haskell website&lt;/a&gt;. But &lt;code class=&quot;language-text&quot;&gt;stack&lt;/code&gt; is also suggested as the alternative. So, which one should a newcomer pick…?&lt;/p&gt;
&lt;h2 id=&quot;building-tool&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#building-tool&quot; aria-label=&quot;building tool permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Building tool&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;cabal&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;stack&lt;/code&gt; are two major Haskell build tools. And it’s not like &lt;code class=&quot;language-text&quot;&gt;npm&lt;/code&gt; vs &lt;code class=&quot;language-text&quot;&gt;yarn&lt;/code&gt; at all.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;stack&lt;/code&gt; uses &lt;code class=&quot;language-text&quot;&gt;cabal&lt;/code&gt; under the hood. The main goal of &lt;code class=&quot;language-text&quot;&gt;stack&lt;/code&gt; is to solve the problem of dependency hell when building with &lt;code class=&quot;language-text&quot;&gt;cabal&lt;/code&gt;.
By default, &lt;code class=&quot;language-text&quot;&gt;stack&lt;/code&gt; uses packages from a curated set of versions of libraries from stackage. If the libraries are included in the stackage package set, they’re going to fit together and compile.&lt;/p&gt;
&lt;p&gt;Besides, &lt;code class=&quot;language-text&quot;&gt;stack&lt;/code&gt; has &lt;a href=&quot;https://stackoverflow.com/questions/30913145/what-is-the-difference-between-cabal-and-stack&quot;&gt;better UX than cabal&lt;/a&gt;.
It’s the recommended tool for starters.&lt;/p&gt;
&lt;h3 id=&quot;stack-install--yarn-install&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#stack-install--yarn-install&quot; aria-label=&quot;stack install  yarn install permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;language-text&quot;&gt;stack install&lt;/code&gt; !== &lt;code class=&quot;language-text&quot;&gt;yarn install&lt;/code&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;stack install&lt;/code&gt; command installs the &lt;strong&gt;binary of the software into your system, not adding a dependency to your project&lt;/strong&gt;.
You have to add the dependency in config file manually which feels primitive.&lt;/p&gt;
&lt;h2 id=&quot;compilation&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#compilation&quot; aria-label=&quot;compilation permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Compilation&lt;/h2&gt;
&lt;p&gt;It took waaaaay longer to add a new dependency and build the project. Whenever you add a new dependency, you have to compile it. For example, the most popular Haskell project on github Pandoc, &lt;a href=&quot;https://github.com/jgm/pandoc/runs/3531295377?check_suite_focus=true&quot;&gt;took around 17 mins to build the macOS artifact&lt;/a&gt;. I can finally feel this xkcd now.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 413px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/27ed4c0b74066c8bb0ab8b5bfb2afe88/6c1e7/compiling.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 87.34177215189874%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAAsTAAALEwEAmpwYAAACjUlEQVQ4y22T226rOhCG8/4P0t70JupdI7VRjylNgRTikJBgRIGAifFBQAED3iruYa+193c1lj365x/PTBBCQgjOeZ7njDE+ghDK85xSyhijlOZ5zr+hlBZFUY9MGGNSyjRNF4sFhFDXddd1Z7PZzc3N3d3d4+Pj9fW1YRgQQsMwLMuazWZZlkkph2GYUEqllAghXdfjOAYArNdr3/e1EcdxAACGYWia9vT05HnefD4nhHwlK2Up5cfHRxiGp9OJMZZl2el0KoqCc/4+QghBCGVZ1jSN/OY3uW3b9XqdpqnrusvlEgCQJAmEUNM0AMDhcNA0bbfbyX8xUTU0TVPXtRjpum4YBnX9Eyi6P5lEURTH8WazCcMwCIIsyxzHgRAihH7aSynlnBNCVMBGKKWfynmeh2G4Xq+fn58fHh4AABhjQkgz0nXdf0v49dw0TVmWh8Nht9tZllUUhe/72+32r5zhm5/jV8OEEMrS6+urbdvv7++bzUZK2fe9ei2EaNv2f5TVI/VbqrGr1cp13e126/s+IUQIEccxQkhZlVLWdf2rvN/vCSFBECyXy82I7/sAAM/z1Niapul5nmma5+fncRxDCDnnX8kY47Zth2FYrVYvLy+e59m23fe9ECJJEsaY53kIIQCAbdtXV1dvb299308458q9EKJpGtM0HcdBCDmOMwwDpXQ6ncKRtm2rqlosFtPp9Hg8fnpO0xRjHEVRnuf7/R5CmKZpGIamaWKMPc9zXffi4sK2baVvWdbZ2Zmu659bhRBSRWZZplbKtu0oijDGdV1zzpMkmc/n9/f3VVWVZXk8Hi8vL29vbz89Y4yrqmKMYYzVAKkZUn/TdV1ZlkEQxHGsOkwpVftTVdU/IluioC5eHyYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;compiling&quot;
        title=&quot;compiling&quot;
        src=&quot;/static/27ed4c0b74066c8bb0ab8b5bfb2afe88/6c1e7/compiling.png&quot;
        srcset=&quot;/static/27ed4c0b74066c8bb0ab8b5bfb2afe88/c26ae/compiling.png 158w,
/static/27ed4c0b74066c8bb0ab8b5bfb2afe88/6bdcf/compiling.png 315w,
/static/27ed4c0b74066c8bb0ab8b5bfb2afe88/6c1e7/compiling.png 413w&quot;
        sizes=&quot;(max-width: 413px) 100vw, 413px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2 id=&quot;ecosystem-and-community&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ecosystem-and-community&quot; aria-label=&quot;ecosystem and community permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Ecosystem and community&lt;/h2&gt;
&lt;p&gt;The Haskell community is much smaller than that of Javascript. Here is the difference in popularity from the &lt;a href=&quot;https://insights.stackoverflow.com/survey/2021#programming-scripting-and-markup-languages&quot;&gt;2021 Developer Survey by Stack Overflow&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cfb26ea5559517a7639833ce5dc3be65/4719e/js-haskell-ratio.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 15.18987341772152%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAlUlEQVQI143MvQqCUACA0Uu0RP+kFoRI2VXDa4hezCEXJdp6laaWDJqioN75i2iOGs56RMdQjJ0Mxy8wbc0hljxyl1suuf/hmbuUYYob77DsFPEOJ06GjCrs2ZpjIrkWinPmU2tJrb2vTtrjohdsggQnrDCnySfsWRFzVbKUGVs/woj3NKwU0VWI/uqn5lDRGgS0RyEveWJfBS6rPS4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Popularity difference between Javascript and Haskell&quot;
        title=&quot;Popularity difference between Javascript and Haskell&quot;
        src=&quot;/static/cfb26ea5559517a7639833ce5dc3be65/f058b/js-haskell-ratio.png&quot;
        srcset=&quot;/static/cfb26ea5559517a7639833ce5dc3be65/c26ae/js-haskell-ratio.png 158w,
/static/cfb26ea5559517a7639833ce5dc3be65/6bdcf/js-haskell-ratio.png 315w,
/static/cfb26ea5559517a7639833ce5dc3be65/f058b/js-haskell-ratio.png 630w,
/static/cfb26ea5559517a7639833ce5dc3be65/40601/js-haskell-ratio.png 945w,
/static/cfb26ea5559517a7639833ce5dc3be65/78612/js-haskell-ratio.png 1260w,
/static/cfb26ea5559517a7639833ce5dc3be65/4719e/js-haskell-ratio.png 1330w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3 id=&quot;the-library-of-choice&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-library-of-choice&quot; aria-label=&quot;the library of choice permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The library of choice…?&lt;/h3&gt;
&lt;p&gt;There are powerful and mature libraries like &lt;a href=&quot;https://hackage.haskell.org/package/aeson&quot;&gt;aeson&lt;/a&gt;, &lt;a href=&quot;https://hackage.haskell.org/package/mtl&quot;&gt;mtl&lt;/a&gt;, &lt;a href=&quot;https://hackage.haskell.org/package/optparse-applicative&quot;&gt;optparse-applicative&lt;/a&gt;. But there are even more unmaintained, outdated or non-versatile libraries. Sometimes you could get frustrated in this process of finding the right library, which could turn out that the library doesn’t exist yet.&lt;/p&gt;
&lt;p&gt;What’s more, occasionally there can be multiple similar libraries, that you have no idea which one is the better choice. The only way is to try them all out.&lt;/p&gt;
&lt;h3 id=&quot;learn-by-code-example-vs-type-puzzle&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#learn-by-code-example-vs-type-puzzle&quot; aria-label=&quot;learn by code example vs type puzzle permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Learn by code example VS type puzzle&lt;/h3&gt;
&lt;p&gt;JS libraries have A LOT more code examples for varies use cases, either from library’s documentation or tutorials and blog posts on the web. In the world of Haskell, except for popular libraries, what you got are mostly type signatures of functions. In many cases, you may not find the code solution on the web. Your objective is to solve the type puzzle, to get the desired transformation. &lt;a href=&quot;https://hoogle.haskell.org&quot;&gt;Hoggle&lt;/a&gt; will be your best friend for searching functions with specific type signature!&lt;/p&gt;
&lt;p&gt;For example, if you are looking for a function which takes a &lt;code class=&quot;language-text&quot;&gt;Text&lt;/code&gt; and return a &lt;code class=&quot;language-text&quot;&gt;String&lt;/code&gt;, &lt;a href=&quot;https://hoogle.haskell.org/?hoogle=Text+-%3E+String&amp;#x26;scope=set%3Astackage&quot;&gt;by searching the function signature&lt;/a&gt; &lt;code class=&quot;language-text&quot;&gt;Text -&gt; String&lt;/code&gt;, you get &lt;code class=&quot;language-text&quot;&gt;unpack&lt;/code&gt; from library &lt;code class=&quot;language-text&quot;&gt;Text&lt;/code&gt; as the first search result.&lt;/p&gt;
&lt;h2 id=&quot;development&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#development&quot; aria-label=&quot;development permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Development&lt;/h2&gt;
&lt;h3 id=&quot;module-import-syntax&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#module-import-syntax&quot; aria-label=&quot;module import syntax permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Module import syntax&lt;/h3&gt;
&lt;p&gt;A package and a module are different. A package is a collection of modules. When you need a library (package), you add the package as project dependency. Then, in source code, you import the modules provided by the library. However the name of modules and the package can be totally unrelated.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hs&quot;&gt;&lt;pre class=&quot;language-hs&quot;&gt;&lt;code class=&quot;language-hs&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;-- from package `containers`&lt;/span&gt;
&lt;span class=&quot;token import-statement&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;List&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;-- from package `optparse-applicative`&lt;/span&gt;
&lt;span class=&quot;token import-statement&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Applicative&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So, if you’re not a seasoned Haskeller, when you read the source code of other Haskell projects, you could have no idea where the module come from, without the help of hoogle and type hinting by haskell lanaguage server.&lt;/p&gt;
&lt;h3 id=&quot;language-extensions-as-feature-flags&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#language-extensions-as-feature-flags&quot; aria-label=&quot;language extensions as feature flags permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Language extensions as feature flags&lt;/h3&gt;
&lt;p&gt;Though &lt;code class=&quot;language-text&quot;&gt;ghc&lt;/code&gt; enhences with &lt;a href=&quot;https://github.com/ghc/ghc/blob/master/libraries/base/changelog.md&quot;&gt;newer versions&lt;/a&gt;, many language features are not toggled on unless explicitly enabled. They are called ”&lt;a href=&quot;https://wiki.haskell.org/Language_extensions&quot;&gt;language extensions&lt;/a&gt;”.
Language extensions can be enabled via command line flags, annotation on top of source code (shown below), or &lt;a href=&quot;https://github.com/chauchakching/just-json-server/blob/d870430eaab5820c028defc873c96f0e0835eada/package.yaml#L38&quot;&gt;config file&lt;/a&gt;. I recommend enabling the language extensions through config file once and for all.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;hs&quot;&gt;&lt;pre class=&quot;language-hs&quot;&gt;&lt;code class=&quot;language-hs&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;{-# LANGUAGE OverloadedStrings #-}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;{-# LANGUAGE DeriveGeneric #-}&lt;/span&gt;

&lt;span class=&quot;token import-statement&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;qualified&lt;/span&gt; Data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Text &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; T&lt;/span&gt;
&lt;span class=&quot;token import-statement&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Applicative&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;can-i-have-all-of-them&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#can-i-have-all-of-them&quot; aria-label=&quot;can i have all of them permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Can I have all of them?&lt;/h4&gt;
&lt;p&gt;One might think: why not simply enable them all? In fact &lt;strong&gt;some language extensions don’t get along with others&lt;/strong&gt; for certain combination of library dependencies!&lt;/p&gt;
&lt;p&gt;Some of the language extensions like &lt;code class=&quot;language-text&quot;&gt;OverloadedStrings&lt;/code&gt; are often used, while some of them like &lt;code class=&quot;language-text&quot;&gt;MultiWayIf&lt;/code&gt; have minor usage, and some of them like &lt;code class=&quot;language-text&quot;&gt;OverlappingInstances&lt;/code&gt; must be used with caution and could be considered bad.&lt;/p&gt;
&lt;p&gt;Take a look at &lt;a href=&quot;https://lexi-lambda.github.io/blog/2018/02/10/an-opinionated-guide-to-haskell-in-2018/&quot;&gt;an opinionated guide to haskell&lt;/a&gt; for reference of a list of suggested language extensions.&lt;/p&gt;
&lt;h4 id=&quot;but-why-language-extensions&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#but-why-language-extensions&quot; aria-label=&quot;but why language extensions permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;But why language extensions?&lt;/h4&gt;
&lt;p&gt;Haskell has been a very academic-facing and advanced functional programming language for years. Language extensions allows researchers to play with Haskell with great flexibility in a per-project basis. This way, Haskell fulfills the usage of both academic and industrial users.&lt;/p&gt;
&lt;h3 id=&quot;broken-batteries-included&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#broken-batteries-included&quot; aria-label=&quot;broken batteries included permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Broken-batteries included&lt;/h3&gt;
&lt;p&gt;Haskell comes with a default package &lt;a href=&quot;https://hackage.haskell.org/package/base&quot;&gt;base&lt;/a&gt; module &lt;code class=&quot;language-text&quot;&gt;Prelude&lt;/code&gt; with a bunch of common functions and type classes. It has been critizied for&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;including partial functions like &lt;code class=&quot;language-text&quot;&gt;head :: [a] -&gt; a&lt;/code&gt; (error when the list is empty) instead of total function &lt;code class=&quot;language-text&quot;&gt;head :: [a] -&gt; Maybe a&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;use of low performance data type &lt;code class=&quot;language-text&quot;&gt;String&lt;/code&gt; which is basically a naive linked list for strings, that should be replaced by a high performance alternative &lt;code class=&quot;language-text&quot;&gt;Text&lt;/code&gt; from package &lt;a href=&quot;https://hackage.haskell.org/package/text&quot;&gt;text&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Similar to &lt;code class=&quot;language-text&quot;&gt;var&lt;/code&gt; vs &lt;code class=&quot;language-text&quot;&gt;let&lt;/code&gt; &amp;#x26; &lt;code class=&quot;language-text&quot;&gt;const&lt;/code&gt; in Javascript, &lt;code class=&quot;language-text&quot;&gt;String&lt;/code&gt; type is gonna stick to here because of historical dependence on this data type. But sometimes you cannot avoid it, because some of the packages you use may involve this data type.&lt;/p&gt;
&lt;p&gt;There are a few options:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;disable the auto import of &lt;code class=&quot;language-text&quot;&gt;Prelude&lt;/code&gt; module, and replace it with other more well-designed packages like &lt;a href=&quot;https://hackage.haskell.org/package/rio&quot;&gt;rio&lt;/a&gt;, &lt;a href=&quot;https://github.com/kowainik/relude&quot;&gt;relude&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;disable the auto import of &lt;code class=&quot;language-text&quot;&gt;Prelude&lt;/code&gt; module, and construct your own prelude module in project&lt;/li&gt;
&lt;li&gt;say fuck it and use it anyway&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;foreign-complex-language-constructs&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#foreign-complex-language-constructs&quot; aria-label=&quot;foreign complex language constructs permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Foreign, complex language constructs&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://www.google.com/search?q=another+monad+tutorial&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 300px; &quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8klEQVQoz5WSaY/aMBCG+f//qFVVdbssy664QxIEORyck5IABh/J2PEqR1nUD1X7yrJmbD1+PfYMdCulVNAqy7I4jjHGYRgGQXA4HKIoQghFUYQxRghhjPVvDQghdStCSJ7nl1a32+3UqguOx+P5fM7zvCiK0+n0CadpyjnXWndHdLd4TB+DbldK6OEkSTjndV0DgGxVVVWXAsAf60opAGjmlm9gxpjW+l/gxl/Vm/3aia3/gyVIKm4rfzIyv0S/nAaOoqirWUqpWgFAl0opH4MTKYbW14UzNLxX3MFZllFK67quqqpzK8tSKVW1uge61iZaLNxnO5gsnGd82H0+2F+cK2hIKujY/m4FbyZ6W7ovYedcFMXduYJmiFJAU3lZVWVTKEhd6zWaT7c/LPS+9sdLZ9g753nOuWitVK26n+xn2X74hZ7n7ni6fbLQu4ka59XdmRDCGAMJohQFyZMiSvI4PAaGP1l5k5kzGtvfZrsnE41X7ovhjwz/de783B+2PRzEyHDnK2duODPLW1re0nCmG2/pYqsdthdudoHpYtvFtrO3dsE6y6MGVlIxxsiFUEo545xyAClYSa9McCG4YJRzJuiNccqFEFdypTcmhACAQVPV5eK6zvV61X0H952cJAlCvhC86+Ra903OGI3jOE3TD6JnT6/hs3VoAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;yet another monad tutorial&quot;
        title=&quot;yet another monad tutorial&quot;
        src=&quot;/static/49065f0157477887e2b76194dcf57427/5a46d/Monad-tutorials-chart.png&quot;
        srcset=&quot;/static/49065f0157477887e2b76194dcf57427/c26ae/Monad-tutorials-chart.png 158w,
/static/49065f0157477887e2b76194dcf57427/5a46d/Monad-tutorials-chart.png 300w&quot;
        sizes=&quot;(max-width: 300px) 100vw, 300px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
    &lt;/span&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;What the fuck is Monad? Functor? Applicative functor? Monoid?&lt;/p&gt;
&lt;p&gt;”&lt;a href=&quot;http://james-iry.blogspot.com/2009/05/brief-incomplete-and-mostly-wrong.html&quot;&gt;Monad is just a monoid in the category of endofunctors&lt;/a&gt;” ?&lt;/p&gt;
&lt;p&gt;And type classes, generics, monad transformer, type-level arithmetic, type family… These all ALL new concepts you don’t see in most of the rest of the programming languages. All these together and type system make Haskell a solid, advanced language, at the expense of steep learning curve.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://learnyouahaskell.com/&quot;&gt;Learn You a Haskell for Great Good&lt;/a&gt; is a good starting point to get familiar with some of these concepts.&lt;/p&gt;
&lt;h2 id=&quot;nonetheless-its-fascinating&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#nonetheless-its-fascinating&quot; aria-label=&quot;nonetheless its fascinating permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Nonetheless, it’s fascinating&lt;/h2&gt;
&lt;p&gt;Haskell is not “just another programming language”. Learning it is like re-learning programming - in a new way. Definitely worth a try.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Learning programming is quite different]]></title><description><![CDATA[Learning programming is unstandardized, informal, and overwhelmed with constantly updating resources with varying qualities in a wide range…]]></description><link>https://cccv.blog/2021-09-06-learning-programming-is-quite-different/</link><guid isPermaLink="false">https://cccv.blog/2021-09-06-learning-programming-is-quite-different/</guid><pubDate>Mon, 06 Sep 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Learning programming is unstandardized, informal, and overwhelmed with constantly updating resources with varying qualities in a wide range, unlike education in school. In school, people learn from classics, from teachers, from old stuffs that rarely change. For programming, the reality is, most of time people learn from technologies and resources different from generation to generation, reinvent the wheel, and repeat mistakes from the past, without much study of well-founded, solid libraries and softwares which have been existing for years.&lt;/p&gt;
&lt;p&gt;That’s the bless, and also the curse of learning software development. Things change &lt;del&gt;fat&lt;/del&gt; fast. The technologies you learnt few years ago “get old”. New and exciting technologies kick those “old” tools ass and replace them in the next few years. The growth is exponential. You gotta catch up and embrace changes for the best.&lt;/p&gt;
&lt;p&gt;It’s especially true for the frontend world. When I graduated, jQuery was still the king. Now it’s ditched like a used condom. Of course, jQuery served us well. But it has reached its end of life. If you start a green field project with it, you’re gonna miss tons of features, libraries and suffer from the shrinking ecosystem.&lt;/p&gt;
&lt;p&gt;Not only the tools change. The problems change. Years ago, SQL injection and XSS were common problems. Pointers and memory leak were headaches. Now you barely get bothered with these problems in day-to-day development, with tools like React and Rust. It’s not always the case though. SQL has been proven to be strong and powerful, and surviving for about half a decade.&lt;/p&gt;
&lt;p&gt;Anyway it’s a little off-topic. This site contains well-written code and documentation from some of the most popular open source softwares. Learn from the best.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://codecatalog.org/&quot;&gt;https://codecatalog.org/&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Viewing Pandoc source code on VS code]]></title><description><![CDATA[It has been some time since I last studied Haskell.
When I look at Monad again, it feels more comfortable about it, and the way to use it to…]]></description><link>https://cccv.blog/2021-09-03-viewing-pandoc-source-code-on-vs-code/</link><guid isPermaLink="false">https://cccv.blog/2021-09-03-viewing-pandoc-source-code-on-vs-code/</guid><pubDate>Thu, 02 Sep 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f0b61cd5c10fc3fb1605e3276e5e1c84/c830c/pandoc-vscode-type-hinting.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.139240506329116%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABf0lEQVQoz4WSS5OiMBhF3fIKSUignRq1GhUEBGxHBZ+bnv//l85UdLprdrM4lZssbr7HnURRSCgkfqzwZIwvJZ4QBCIiDAO8IMTzfDzP+y++7zMJw5BIakSSEiUGYSyzPGddlvyczfgxnTLNpqRpSppmf3npLPuXN4QQTIIgQEiFNBZhEuIkoet7hmHkdBq43x5cLzfu98fzfhjOHC4PdocTXddTVTVFUVKWG5IkcRUGCKWRNkWkhjhN2e06rteBtm3pfg3sjwP97oNm27GpajabinVRkudLlsvVN8aYL0NDbDPCzBK/pYznC5+fvxnHV5XX6+15NnVD02yp64bttqVtuydOO9woJm4pUSyJlCbUitgaPvZ7htOJ4/GFM3MjGMbzE/ehe3dmru2XcY+11hlGaK3IXHVSoY3lvahZ9SOr7Z513VI0/ZO86nkvG/KiYjFfMJvNv5nPFyilXoZuO44vHQhFrC3GWHSSoBKDdmiNUhIpJS4dLiZuqV+42PwBA5jXAjQTJ+4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;pandoc-vscode-type-hinting&quot;
        title=&quot;pandoc-vscode-type-hinting&quot;
        src=&quot;/static/f0b61cd5c10fc3fb1605e3276e5e1c84/f058b/pandoc-vscode-type-hinting.png&quot;
        srcset=&quot;/static/f0b61cd5c10fc3fb1605e3276e5e1c84/c26ae/pandoc-vscode-type-hinting.png 158w,
/static/f0b61cd5c10fc3fb1605e3276e5e1c84/6bdcf/pandoc-vscode-type-hinting.png 315w,
/static/f0b61cd5c10fc3fb1605e3276e5e1c84/f058b/pandoc-vscode-type-hinting.png 630w,
/static/f0b61cd5c10fc3fb1605e3276e5e1c84/40601/pandoc-vscode-type-hinting.png 945w,
/static/f0b61cd5c10fc3fb1605e3276e5e1c84/78612/pandoc-vscode-type-hinting.png 1260w,
/static/f0b61cd5c10fc3fb1605e3276e5e1c84/c830c/pandoc-vscode-type-hinting.png 1754w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;It has been some time since I last studied Haskell.
When I look at Monad again, it feels more comfortable about it, and the way to use it to write code.
So I’ve decided to have a look at the most popular Haskell software - Pandoc, to see how Haskell is used
to structure a large and mature programme.&lt;/p&gt;
&lt;p&gt;However it took more than I expected to view the source code plus Haskell plugin for type hinting on VS code.&lt;/p&gt;
&lt;h2 id=&quot;getting-started&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#getting-started&quot; aria-label=&quot;getting started permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Getting started&lt;/h2&gt;
&lt;p&gt;First step, clone the repository.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/jgm/pandoc.git

&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; pandoc&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then, open it with VS code.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;code &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;a href=&quot;https://marketplace.visualstudio.com/items?itemName=haskell.haskell&quot;&gt;VS code plugin Haskell&lt;/a&gt; should be the most convenient and popular one for type check and type hinting as of now.
I remember the last time it required you to install Haskell Language Server manually.&lt;/p&gt;
&lt;p&gt;That’s it! …right? No.&lt;/p&gt;
&lt;h2 id=&quot;first-error-message&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#first-error-message&quot; aria-label=&quot;first error message permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;First error message&lt;/h2&gt;
&lt;p&gt;An error message popped up on VS code.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Project requires Cabal but it isn’t installed&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Frankly, I’ve never used &lt;code class=&quot;language-text&quot;&gt;cabal&lt;/code&gt; to build and package Haskell project. I picked &lt;code class=&quot;language-text&quot;&gt;stack&lt;/code&gt;.
Apparently I have to learn both eventually, despite the suggestion of “just pick one (stack) and stick to it”.&lt;/p&gt;
&lt;p&gt;So I followed the instruction of the error message, and use &lt;code class=&quot;language-text&quot;&gt;ghcup&lt;/code&gt; to install &lt;code class=&quot;language-text&quot;&gt;ghc&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;cabal&lt;/code&gt; on &lt;a href=&quot;https://www.haskell.org/ghcup/&quot;&gt;https://www.haskell.org/ghcup/&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;the-same-error-message&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#the-same-error-message&quot; aria-label=&quot;the same error message permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;The same error message&lt;/h2&gt;
&lt;p&gt;The error message persisted. What..?&lt;/p&gt;
&lt;p&gt;After some frustration and some google searches, I found &lt;a href=&quot;https://github.com/haskell/haskell-language-server/issues/236#issuecomment-877706828&quot;&gt;this github issue comment&lt;/a&gt; that &lt;strong&gt;somehow&lt;/strong&gt; resolved the issue, by opening VS code with additional flag &lt;code class=&quot;language-text&quot;&gt;--force-user-env&lt;/code&gt;!&lt;/p&gt;
&lt;h2 id=&quot;ghc-version-not-supported&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#ghc-version-not-supported&quot; aria-label=&quot;ghc version not supported permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ghc version not supported&lt;/h2&gt;
&lt;p&gt;After restarting vs code with the additional flag, the error was gone, but another one popped up:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;haskell-language-server 1.3.0 for GHC 8.10.7 is not available on Darwin. See the list of supported versions here&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I happened to pick a ghc version that is not supported by haskell language server. Okay, let’s install another one.
I checked the supported ghc versions on &lt;a href=&quot;https://github.com/haskell/vscode-haskell#supported-ghc-versions&quot;&gt;https://github.com/haskell/vscode-haskell#supported-ghc-versions&lt;/a&gt;, and check the ghc version I’s using with command &lt;code class=&quot;language-text&quot;&gt;ghcup tui&lt;/code&gt;. Right, I’s using &lt;code class=&quot;language-text&quot;&gt;8.10.7&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;At the time, the support for version &lt;code class=&quot;language-text&quot;&gt;9.0.1&lt;/code&gt; was limited. Alright, let’s downgrade it to &lt;code class=&quot;language-text&quot;&gt;8.10.5&lt;/code&gt; with the &lt;code class=&quot;language-text&quot;&gt;ghcup&lt;/code&gt; tool.&lt;/p&gt;
&lt;h2 id=&quot;stuck-in-the-build-process&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#stuck-in-the-build-process&quot; aria-label=&quot;stuck in the build process permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Stuck in the build process&lt;/h2&gt;
&lt;p&gt;Error messages are all gone now! All I need to do is to wait a hackable long time for the haskell plugin to initialize.
It needs to build the project. At some point, my macbook’s fan stopped spinning, however the building process was still in progress.&lt;/p&gt;
&lt;p&gt;I checked the vs code output of the haskell plugin. Turned out the build process hanged at the “building the network package”.&lt;/p&gt;
&lt;p&gt;Luckily, I found the solution on &lt;a href=&quot;https://github.com/haskell/cabal/issues/6845#issuecomment-873501610&quot;&gt;this github issue&lt;/a&gt; again.
All I need do was to change to &lt;strong&gt;another ghc version&lt;/strong&gt;. Let’s downgrade again to &lt;code class=&quot;language-text&quot;&gt;8.10.4&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The build process went thorough the network package!&lt;/p&gt;
&lt;h2 id=&quot;final-step-wait&quot; style=&quot;position:relative;&quot;&gt;&lt;a href=&quot;#final-step-wait&quot; aria-label=&quot;final step wait permalink&quot; class=&quot;anchor before&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;final step: wait&lt;/h2&gt;
&lt;p&gt;Wait for the build process to finish. Then, voila! Isn’t is easy?&lt;/p&gt;</content:encoded></item></channel></rss>