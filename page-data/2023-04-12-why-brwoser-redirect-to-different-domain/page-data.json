{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/2023-04-12-why-brwoser-redirect-to-different-domain/",
    "result": {"data":{"site":{"siteMetadata":{"title":"cccv blog"}},"markdownRemark":{"id":"a4c5fe89-d85c-5d91-83a0-c7d1a9e024b2","excerpt":"If I run this script , where would the browser take me to? ? or ?\nWhen I first bumped into this question, I thought I knew how the browser’s behavior pretty…","html":"<p>If I run this script</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">// originally on https://example.com</span>\nwindow<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> <span class=\"token string\">\"/\\\\abc.com\"</span></code></pre></div>\n<p>, where would the browser take me to? <code class=\"language-text\">example.com/\\abc.com</code>? or <code class=\"language-text\">abc.com</code>?\nWhen I first bumped into this question, I thought I knew how the browser’s behavior pretty well.</p>\n<h1 id=\"analysis\" style=\"position:relative;\"><a href=\"#analysis\" aria-label=\"analysis permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Analysis</h1>\n<p>The string <code class=\"language-text\">\"/\\\\abc.com\"</code> in js has an extra backslash to escape the backslash to represent text <code class=\"language-text\">/\\abc.com</code>.\nAs the string starts with a single forward slash <code class=\"language-text\">/</code>, it should be a relative path, right? But no.\nWhen I run</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\">window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> <span class=\"token string\">\"/\\\\abc.com\"</span></code></pre></div>\n<p>, browser takes me to <code class=\"language-text\">abc.com</code>.\nWhich means it is indeed an absolute path. Why??</p>\n<p>Here are the most common cases of browser redirect (potentially relative) url for redirect:</p>\n<ul>\n<li><code class=\"language-text\">https://google.com</code>: includes protocol/scheme <code class=\"language-text\">https</code>, so it’s an absolute path</li>\n<li><code class=\"language-text\">//abc.com</code>: not that common, but <a href=\"https://stackoverflow.com/questions/6785442/browser-support-for-urls-beginning-with-double-slash\">it’s an absolute path</a> and stated in in RFC 1808</li>\n<li><code class=\"language-text\">/home</code>: the usual relative path</li>\n<li><code class=\"language-text\">apple</code>: a relative path, and the redirect will replace the last part of pathname with <code class=\"language-text\">apple</code> e.g. <code class=\"language-text\">example.com/a/b/c</code> -> <code class=\"language-text\">example.com/a/b/apple</code></li>\n<li><code class=\"language-text\">home.html</code>: a relative path, similar to <code class=\"language-text\">apple</code></li>\n<li><code class=\"language-text\">/home.html</code>: a relative path, similar to <code class=\"language-text\">home.html</code></li>\n</ul>\n<p>None of the cases have anything to do with the backslash <code class=\"language-text\">\\</code>.</p>\n<h1 id=\"mdn\" style=\"position:relative;\"><a href=\"#mdn\" aria-label=\"mdn permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MDN?</h1>\n<p>Didn’t mention anything special about backslash.</p>\n<h1 id=\"google\" style=\"position:relative;\"><a href=\"#google\" aria-label=\"google permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Google?</h1>\n<p>Couldn’t really find anything related to url redirect with backslash.</p>\n<h1 id=\"would-chatgpt-gpt-4-know-the-answer\" style=\"position:relative;\"><a href=\"#would-chatgpt-gpt-4-know-the-answer\" aria-label=\"would chatgpt gpt 4 know the answer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Would ChatGPT (GPT-4) know the answer?</h1>\n<p>Let’s give it a try.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/152c41e1de5d1b01db51e2cebf4ed392/17d12/ask-chatgpt-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 96.20253164556962%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAAC9klEQVQ4y41U2W7TUBB1kXirxG8h9T8QVCgVBbXJP7RNaatGLYjlqbzDC18BbbPvcRzHjndn85qDZhwnKeWBKx3N3JnrubOca2E+90DwPP8BfH8tHWcMy3Iwm81Xds9bf0P2FEIURXxoPB7DMEw4jgvLslknaZoWS7LbtsM6yXRP38VxjMViwRBoE4YhdN2AJMlQVQ3DocpQlETKQ4UD+UGwrMbjb+aeB98PsLkEys513fUt8WJ1W4rUR2vTTitNKAgChiDLQ9zcfIM0UNBoddHuiKjWmqjVWywbzQ66PQn1RhvNpb/e7KDV7vF5sS9DHqpw3QkmkykEauR0OoNhWFAUDUNlBFXVoY4S0F7TDCiqhoGsYDRa+yjQeDzhNlAckhyQJkUf0u10Y08cMCgztkky2t3+ytYVJZZ0li5Kg/GUk4AeO6msVkfcCCyhRrZleVQ+ldtYlkyg1ui6uaKPkEa3bIfLJtABg+niwDRtttm2C92weE+gPZ3RmWrjvzP0OaNSuY5ytcFZVapN1inrX7clHlCxXEepUsd9qYa7YpX1Sq0Jw7QfB6RedDoi90nsD7jhhL40RLvTQ78vw3ZcmJbDhGbpuElVpvXvoVBP2tzDHgdaDUeU+BKaNrVjpBms08SJ8I+mTAqlTUFHmglNNzljVdNh2S4HT/waxpMp5jSAuYfpMhlaq5KJg1EY4fuPnzg+LeAkf4mj4wtG/uQSp/kCjo8ukM8XkD8t4P3ZFc7Pr3F2doXLwidcXX/F5y83/ObpGQrEblo7z3cgCAK2tp5CEJ6w/r/Y3n6GbldEFMVJhvEC+Hj9Aa9fvEQum0U2e4jDgwPs7b9B5t0+Mm/3Wd/LZJBZYm8vwe7uK+RyOWianmSY1u4HIbwggueH8IMIszk99ogRBjECQhizj/S5FzDIRouCPaANTff3bYm5eF9KOFYs1xK9XMddsYIi86/CPuJl+sMg6jzgIb8Uy2EaEKdoyvQaUpqkLyTRTT4bBskvizLbpM0fUIJJ0TWZsg8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ask-chatgpt-1\"\n        title=\"ask-chatgpt-1\"\n        src=\"/static/152c41e1de5d1b01db51e2cebf4ed392/f058b/ask-chatgpt-1.png\"\n        srcset=\"/static/152c41e1de5d1b01db51e2cebf4ed392/c26ae/ask-chatgpt-1.png 158w,\n/static/152c41e1de5d1b01db51e2cebf4ed392/6bdcf/ask-chatgpt-1.png 315w,\n/static/152c41e1de5d1b01db51e2cebf4ed392/f058b/ask-chatgpt-1.png 630w,\n/static/152c41e1de5d1b01db51e2cebf4ed392/40601/ask-chatgpt-1.png 945w,\n/static/152c41e1de5d1b01db51e2cebf4ed392/78612/ask-chatgpt-1.png 1260w,\n/static/152c41e1de5d1b01db51e2cebf4ed392/17d12/ask-chatgpt-1.png 1666w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Nahhh, wrong. ChatGPT thought <code class=\"language-text\">/\\abc.com</code> was a relative path too.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/36d264751eaa2f55788959c2d6696726/17d12/ask-chatgpt-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.0379746835443%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAACtklEQVQ4y5VUyXLTQBBVAlwgyddk4UAwF4pvyOfAhTP5DKjKH4RzuMQLjixL3rTLi6SRvMlL/KhuWeMslQOueu6entGbN909o2TZAkF/iFpdg6a3cdcw0NBa0I0OW1UzdrbZ4nnL9uAHA/QHI4RhjPk8w2w2ZyhEWGCxWErsYgs5pg8JNF4uV3JtEScoWZazx0JAiAQiSRDHAkmSIk1TGUvTMe7v77HZbNjusOFYAYX+1us1iDiTO82lOo5nGZbLJV76PSK8vv4N3w+QJGMIkeY2SXOIwpLqBFEk2LIfC4RRjCQd8wknk2mew5ubP+j2LE64bnTRNDpo6h1ozTbbVseE3upywWieCtTuWhyjolAq6FSSkCRPp3PeLYwE70wgdWRHo4grSRiFESsin1QSGakmsqIWCrH3t21DKrlFGgbqqg6t2UK1puJvXcOdqrMllXW1KddXaiqLoZzLtiElpuVwf5m2y7ZnOjAtF7bjy5jleLBsl+N+MMxPFcaYTGayF5mQ5NMHjuvD9QLYjsdEnt/PiWyXfdcN5HwQDPO0RALj8eQ5Yadnsyoi7W79h5ZI2TcplseNVo/niFjmkHptMBhxddvbihLoA1a9VUQbFcopRsR5POCiSIVEOByGnPBOx4Kq6lAbOkzT4SM6jg+XUkHHfQLP6/P8cBjtCKltfv66wulpCefnn3F2VsLZ+084Of2I45Pzxzj+8MiWSl94/ddv37HZUPvNcsLLH5dQFAVHb9/h8OgQBwcH2Hu1D+X1Xo43+zz/Ei4uLvgK0tEVei2CoI9yuYJqtca2QKVc3aKCSqX6DLT+9raMXs982ocJbIdaos++SMaIRcogn24Q2ShKeD6OU47lNpFPl7wp9CAEwYCLU9zJ2XTGoLzQOLcPMZd+sYYJV6s1P1/F+0bj1Wr1n1hL/ANXr0lcLun6QwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ask-chatgpt-2\"\n        title=\"ask-chatgpt-2\"\n        src=\"/static/36d264751eaa2f55788959c2d6696726/f058b/ask-chatgpt-2.png\"\n        srcset=\"/static/36d264751eaa2f55788959c2d6696726/c26ae/ask-chatgpt-2.png 158w,\n/static/36d264751eaa2f55788959c2d6696726/6bdcf/ask-chatgpt-2.png 315w,\n/static/36d264751eaa2f55788959c2d6696726/f058b/ask-chatgpt-2.png 630w,\n/static/36d264751eaa2f55788959c2d6696726/40601/ask-chatgpt-2.png 945w,\n/static/36d264751eaa2f55788959c2d6696726/78612/ask-chatgpt-2.png 1260w,\n/static/36d264751eaa2f55788959c2d6696726/17d12/ask-chatgpt-2.png 1666w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Even given with feedback to correct the answer, ChatGPT couldn’t tell why.</p>\n<h1 id=\"more-background\" style=\"position:relative;\"><a href=\"#more-background\" aria-label=\"more background permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>More background</h1>\n<p>Actually my ultimate goal was to create a function that determines if a string would\ncause domain change in browser redirect. Long story short, with the help of ChatGPT,\nI have the following function:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">function</span> <span class=\"token function\">willDomainChangeWhenRedirect</span><span class=\"token punctuation\">(</span>url<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Create a link element to easily parse the input URL</span>\n  <span class=\"token keyword\">const</span> link <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span>\n  link<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> url\n\n  <span class=\"token comment\">// Get the hostname of the input URL and the current window</span>\n  <span class=\"token keyword\">const</span> newHostname <span class=\"token operator\">=</span> link<span class=\"token punctuation\">.</span>hostname\n  <span class=\"token keyword\">const</span> currentHostname <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>location<span class=\"token punctuation\">.</span>hostname\n\n  <span class=\"token comment\">// Compare the hostnames and return true if they are different</span>\n  <span class=\"token keyword\">return</span> newHostname <span class=\"token operator\">!==</span> currentHostname\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>At the end, I had to rely on browser’s implementation to parse the url string and get the hostname.\nAny custom logic in implementation could differs from the browser’s implementation.\nI wonder: what is the url construction logic in the browser engine?</p>\n<h1 id=\"checking-chromium-source-code\" style=\"position:relative;\"><a href=\"#checking-chromium-source-code\" aria-label=\"checking chromium source code permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Checking chromium source code</h1>\n<p>I was left with one final choice: check the source code of chromium. But the project is huge.\nIt would take me lots of time! What if, we ask ChatGPT for guidance?</p>\n<p>Let’s start from asking for entry point of reading the source code.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3f77253bcfb82cd039b6686282d7c95b/81315/ask-chatgpt-chromium-1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 108.22784810126582%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC1ElEQVQ4y41V13biUAzk/38n+xubSrFxwwbcO25AwuwZ2dcLyT4s50xun0gaSV70/YBhOAvO5wvO5/M3XFBVJxRFja4bZP33/nlek4dYXK9XOWjaFnV9EpxOjUDN1b5C13Vo2246q9G2Lb6+vgRC2Pc9/CBEnhcy58WmaQV8qOZqPQyD3CMR73ZdD/VbkPV2Az4/P/G/v9vtJvi7Mb4nFpqm4+npF7KshLf3cfQj7A/+hACHYyj7vh/JyLXsH4L5Ps/quhEs6Kbn7eXQsl04uz1sx4O982ROGNYO5h14btoutqYDy/Hg7o/iuohClS6XK3buAbphwzAdma83WyzXOpYrDdrWEhISbDQTUZQgSXMkSYY4ySS2JGMsF/xD5EWJPC+RZQWKspIx5aM0G/fzYlK4v0uxEYpMLFSLKE5xOAZT3AIc/VDAOeMWRgmatpsff8eDhVzQmo1mYGvYEic16ltL9hmKIIz/SXZPOhPSgt8vH3hfbvD6tsLL2wrPrx9Ya4bEz7AcEY1W+0EkY1nWEn8WxmyhmjBOfGA7rljk7EYSClBWNYqikjinWSGCqPgqYdopHDNhGCaSHlR0o5uSFlRd0y3ZW1H1lS7Wv39s8Py6hGHaco8WP7hM1agg40T3mJOMIUcmuOsdZc1/5HoH8YZWNk0n1XG9XH+KQpf4eFR6HKM4mVQeK4OiMG7KfaYXQ8CU+pE2JFGVwcQmCWOqoBJeVRRd5ZpikvyHy0wPxoXxYdx4mVVCrNb6TMJ4rjeGjKwc7rEIyDGr3La9WGZaLhx3L/mnrDUnItY240tiZgFLk6Sabsre3GCVy1TK2x8n+KinJjs20bHJsnOPe+1d821QTSX5mDZRgjCMhZigAIIgRhyniKJ0zjmuBdOcxMP35kDL7l2j63M723nyWClLiNqcF9Vjt1EfGX4KpOteR6g1y4o9s5BuVMhDlttF2t4I3lEfrT/NV3hZoRnKsgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ask-chatgpt-chromium-1\"\n        title=\"ask-chatgpt-chromium-1\"\n        src=\"/static/3f77253bcfb82cd039b6686282d7c95b/f058b/ask-chatgpt-chromium-1.png\"\n        srcset=\"/static/3f77253bcfb82cd039b6686282d7c95b/c26ae/ask-chatgpt-chromium-1.png 158w,\n/static/3f77253bcfb82cd039b6686282d7c95b/6bdcf/ask-chatgpt-chromium-1.png 315w,\n/static/3f77253bcfb82cd039b6686282d7c95b/f058b/ask-chatgpt-chromium-1.png 630w,\n/static/3f77253bcfb82cd039b6686282d7c95b/40601/ask-chatgpt-chromium-1.png 945w,\n/static/3f77253bcfb82cd039b6686282d7c95b/78612/ask-chatgpt-chromium-1.png 1260w,\n/static/3f77253bcfb82cd039b6686282d7c95b/81315/ask-chatgpt-chromium-1.png 1656w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>That’s a good start! Then I follow the steps to try to get to the source code:</p>\n<ol>\n<li>the chromium source code link is real,</li>\n<li>the directory path is also real,</li>\n<li>the directory do contains the file <code class=\"language-text\">html_anchor_element.cc</code>,</li>\n<li>I couldn’t find the methods <code class=\"language-text\">SetURLAttribute()</code> and <code class=\"language-text\">GetURLAttribute()</code>, but</li>\n<li>I did find <a href=\"https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/core/html/html_anchor_element.cc;l=309\"><code class=\"language-text\">HTMLAnchorElement::Href()</code></a>, which is exactly what we’re looking for!</li>\n</ol>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8960aec7d9a16bc65ae61c18bb41a2f9/28b65/ask-chatgpt-chromium-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.632911392405056%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB6klEQVQoz22SycrbMBRG/bTd9dG6a1+gFLrqolDaP4mHxLM1eZQlx05OsQOFwi846HLhHulDCqxbmZ1DaU0jBI2QdF2HNhohJVIbVD+henvUUmnU3tMGbVpKNZCLntHOhycw40qjO0zbUqseZTq68Y7qFio1URY58s831Ok7Q98x+wU7O6zz2NnTDjO632Ue5z2B7hxt/8TOMLuFcXKc0x+cbl84pT8JS0+YNFyugrhZSORGIlcSsRKLO1e5HrzqO8Gv8Ex8+8Q1/0yhRkR3p6oyjMio6xQpDZNb8RvM/o7zy3Gw8yvL+vgPf98IwuQrcfKBS/QRoRsGu2HMgCkN13PI9Xw6YpdlQZYVFJWiEQo7TTweD7ZtPXhsG8uyEMRxTJyERNEFa2eGcUIqxSAG0nNOVdZHLy8riqomrxrKqqFqBHlRkuY5WV7QSIWdZ4IwvhFGNy7hlbISNFITpw1KdlSVpKoFSRJxfjtxS4tDsouzojrYxXUjqYU8HjRIs1eUfR9Gy2gdQrX0eiDPd0FBePlNdHmjyEvquqFtW4wxR6JX7J2NddsIrreMnV042f07LChpaM0+pI/Btu0YuomhH7B2wnvP8/nkvRWEUcL5ErHvh3D2SGWQtaIsyuM20zThJse6rv8Gd+F7/AXQpvIgmJMUHQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ask-chatgpt-chromium-2\"\n        title=\"ask-chatgpt-chromium-2\"\n        src=\"/static/8960aec7d9a16bc65ae61c18bb41a2f9/f058b/ask-chatgpt-chromium-2.png\"\n        srcset=\"/static/8960aec7d9a16bc65ae61c18bb41a2f9/c26ae/ask-chatgpt-chromium-2.png 158w,\n/static/8960aec7d9a16bc65ae61c18bb41a2f9/6bdcf/ask-chatgpt-chromium-2.png 315w,\n/static/8960aec7d9a16bc65ae61c18bb41a2f9/f058b/ask-chatgpt-chromium-2.png 630w,\n/static/8960aec7d9a16bc65ae61c18bb41a2f9/40601/ask-chatgpt-chromium-2.png 945w,\n/static/8960aec7d9a16bc65ae61c18bb41a2f9/78612/ask-chatgpt-chromium-2.png 1260w,\n/static/8960aec7d9a16bc65ae61c18bb41a2f9/28b65/ask-chatgpt-chromium-2.png 2414w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>I haven’t written C++ since uni. But my rusty C++ knowledge served me good.\nAfter some digging, I traced to the <a href=\"https://source.chromium.org/chromium/chromium/src/+/refs/heads/main:third_party/blink/renderer/core/dom/document.cc;l=7096;drc=9329f990b89052f1e7f82e0a1a4b298b72359263;bpv=1;bpt=1\"><code class=\"language-text\">KURL()</code></a> constructor in <code class=\"language-text\">third_party/blink/renderer/core/dom/document.cc</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d202f083210ce6cddce2c23841369b9d/28b65/ask-chatgpt-chromium-3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.632911392405056%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABw0lEQVQoz2WS647bIBBG/f6PV6mrtkm8dmJzNQQH8CXO7qnMRmnV/jj6vgFmxMBU07IxzwuDc2hj0MYSQsB5j7G2sO9Z5zCDww5fOnhf/H7ePNeUsVQ+bmgX8eGGHkYGHwhxYQgZYTzShuLztDAt6xfzQp6Xon9YiXmiciERxkjKX0kpT7w1nu9t5KQ3fomFn/3MQS4c1cJBzpz0Sm02anOn1veXNvZO9e3k+HEeEW5FhTs2rPRCE2NmWe+Mt1RIaeaWMjFNrOuD7QO2x+d/VMdGULcKF6bS6hgXemkwakArQ9cLRC8ZjMfagasbWZeNj09efP7lq7puqOt3mvZckpUynM6GVjg65eiV49wbLtIg1ZVeOC7CYq8Z6xPGR/RwwxSfqI6nhlPdcKwbpDLcYkZpQ756vNE47xgGi3WhtJ7z3n4sujPlTErpFVfnS8+lE7w3l1Js/6BeakbjUZ3i0gvac8e5l3RCIZVGSEUn5Ev3kYkplzeumvZSEoTUpDyTp7XMY75m2uOBrmuRokcriTGKwRpyikzlds+b7fGUC9Xh9M7hWJei+9jsBTt9xZoRHzLj9GDMj6duhHTnNn8Q/+H25DdFoPWpmla6JwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ask-chatgpt-chromium-3\"\n        title=\"ask-chatgpt-chromium-3\"\n        src=\"/static/d202f083210ce6cddce2c23841369b9d/f058b/ask-chatgpt-chromium-3.png\"\n        srcset=\"/static/d202f083210ce6cddce2c23841369b9d/c26ae/ask-chatgpt-chromium-3.png 158w,\n/static/d202f083210ce6cddce2c23841369b9d/6bdcf/ask-chatgpt-chromium-3.png 315w,\n/static/d202f083210ce6cddce2c23841369b9d/f058b/ask-chatgpt-chromium-3.png 630w,\n/static/d202f083210ce6cddce2c23841369b9d/40601/ask-chatgpt-chromium-3.png 945w,\n/static/d202f083210ce6cddce2c23841369b9d/78612/ask-chatgpt-chromium-3.png 1260w,\n/static/d202f083210ce6cddce2c23841369b9d/28b65/ask-chatgpt-chromium-3.png 2414w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Here is the <code class=\"language-text\">KURL</code> init function</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">void</span> <span class=\"token class-name\">KURL</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">Init</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> KURL<span class=\"token operator\">&amp;</span> base<span class=\"token punctuation\">,</span>\n                <span class=\"token keyword\">const</span> String<span class=\"token operator\">&amp;</span> relative<span class=\"token punctuation\">,</span>\n                <span class=\"token keyword\">const</span> WTF<span class=\"token double-colon punctuation\">::</span>TextEncoding<span class=\"token operator\">*</span> query_encoding<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// As a performance optimization, we do not use the charset converter</span>\n  <span class=\"token comment\">// if encoding is UTF-8 or other Unicode encodings. Note that this is</span>\n  <span class=\"token comment\">// per HTML5 2.5.3 (resolving URL). The URL canonicalizer will be more</span>\n  <span class=\"token comment\">// efficient with no charset converter object because it can do UTF-8</span>\n  <span class=\"token comment\">// internally with no extra copies.</span>\n\n  StringUTF8Adaptor <span class=\"token function\">base_utf8</span><span class=\"token punctuation\">(</span>base<span class=\"token punctuation\">.</span><span class=\"token function\">GetString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// We feel free to make the charset converter object every time since it's</span>\n  <span class=\"token comment\">// just a wrapper around a reference.</span>\n  KURLCharsetConverter <span class=\"token function\">charset_converter_object</span><span class=\"token punctuation\">(</span>query_encoding<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  KURLCharsetConverter<span class=\"token operator\">*</span> charset_converter <span class=\"token operator\">=</span>\n      <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>query_encoding <span class=\"token operator\">||</span> <span class=\"token function\">IsUnicodeEncoding</span><span class=\"token punctuation\">(</span>query_encoding<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n          <span class=\"token operator\">?</span> <span class=\"token keyword\">nullptr</span>\n          <span class=\"token operator\">:</span> <span class=\"token operator\">&amp;</span>charset_converter_object<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Clamp to int max to avoid overflow.</span>\n  url<span class=\"token double-colon punctuation\">::</span>RawCanonOutputT<span class=\"token operator\">&lt;</span><span class=\"token keyword\">char</span><span class=\"token operator\">></span> output<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>relative<span class=\"token punctuation\">.</span><span class=\"token function\">IsNull</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> relative<span class=\"token punctuation\">.</span><span class=\"token function\">Is8Bit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    StringUTF8Adaptor <span class=\"token function\">relative_utf8</span><span class=\"token punctuation\">(</span>relative<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    is_valid_ <span class=\"token operator\">=</span> url<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">ResolveRelative</span><span class=\"token punctuation\">(</span>base_utf8<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> base_utf8<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                     base<span class=\"token punctuation\">.</span>parsed_<span class=\"token punctuation\">,</span> relative_utf8<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                     <span class=\"token generic-function\"><span class=\"token function\">ClampTo</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>relative_utf8<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                     charset_converter<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>output<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>parsed_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    is_valid_ <span class=\"token operator\">=</span> url<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">ResolveRelative</span><span class=\"token punctuation\">(</span>base_utf8<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> base_utf8<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                     base<span class=\"token punctuation\">.</span>parsed_<span class=\"token punctuation\">,</span> relative<span class=\"token punctuation\">.</span><span class=\"token function\">Characters16</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                     <span class=\"token generic-function\"><span class=\"token function\">ClampTo</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>relative<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                                     charset_converter<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>output<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>parsed_<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// url canonicalizes to 7-bit ASCII, using punycode and percent-escapes</span>\n  <span class=\"token comment\">// This makes it safe to call FromUTF8() below and still keep using parsed_</span>\n  <span class=\"token comment\">// which stores byte offsets: Since it's all ASCII, UTF-8 byte offsets</span>\n  <span class=\"token comment\">// map 1-to-1 to UTF-16 codepoint offsets.</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>size_t i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> output<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token operator\">++</span>i<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">DCHECK</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">WTF</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">IsASCII</span><span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// AtomicString::fromUTF8 will re-hash the raw output and check the</span>\n  <span class=\"token comment\">// AtomicStringTable (addWithTranslator) for the string. This can be very</span>\n  <span class=\"token comment\">// expensive for large URLs. However, since many URLs are generated from</span>\n  <span class=\"token comment\">// existing AtomicStrings (which already have their hashes computed), this</span>\n  <span class=\"token comment\">// fast path is used if the input string is already canonicalized.</span>\n  <span class=\"token comment\">//</span>\n  <span class=\"token comment\">// Because this optimization does not apply to non-AtomicStrings, explicitly</span>\n  <span class=\"token comment\">// check that the input is Atomic before moving forward with it. If we mark</span>\n  <span class=\"token comment\">// non-Atomic input as Atomic here, we will render the (const) input string</span>\n  <span class=\"token comment\">// thread unsafe.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>relative<span class=\"token punctuation\">.</span><span class=\"token function\">IsNull</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> relative<span class=\"token punctuation\">.</span><span class=\"token function\">Impl</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">IsAtomic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n      <span class=\"token function\">StringView</span><span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token generic-function\"><span class=\"token function\">static_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token keyword\">unsigned</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span>\n          relative<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    string_ <span class=\"token operator\">=</span> relative<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    string_ <span class=\"token operator\">=</span> <span class=\"token class-name\">AtomicString</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">FromUTF8</span><span class=\"token punctuation\">(</span>output<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">InitProtocolMetadata</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">InitInnerURL</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">DCHECK</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token double-colon punctuation\">::</span>blink<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">ProtocolIsJavaScript</span><span class=\"token punctuation\">(</span>string_<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token function\">ProtocolIsJavaScript</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Check for deviation characters in the string. See</span>\n  <span class=\"token comment\">// https://unicode.org/reports/tr46/#Table_Deviation_Characters</span>\n  has_idna2008_deviation_character_ <span class=\"token operator\">=</span>\n      base<span class=\"token punctuation\">.</span>has_idna2008_deviation_character_ <span class=\"token operator\">||</span>\n      relative<span class=\"token punctuation\">.</span><span class=\"token function\">Contains</span><span class=\"token punctuation\">(</span>u<span class=\"token string\">\"\\u00DF\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>  <span class=\"token comment\">// Sharp-s</span>\n      relative<span class=\"token punctuation\">.</span><span class=\"token function\">Contains</span><span class=\"token punctuation\">(</span>u<span class=\"token string\">\"\\u03C2\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>  <span class=\"token comment\">// Greek final sigma</span>\n      relative<span class=\"token punctuation\">.</span><span class=\"token function\">Contains</span><span class=\"token punctuation\">(</span>u<span class=\"token string\">\"\\u200D\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>  <span class=\"token comment\">// Zero width joiner</span>\n      relative<span class=\"token punctuation\">.</span><span class=\"token function\">Contains</span><span class=\"token punctuation\">(</span>u<span class=\"token string\">\"\\u200C\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>    <span class=\"token comment\">// Zero width non-joiner</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">url::ResolveRelative()</code> function seems to be one holding the logic.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7ff2356ab737c05cd4fafa5854d2ea46/764d0/ask-chatgpt-chromium-4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB2ElEQVQoz42R63KjMAxGef9n685k2m2SDQkkhADmahNjm1vODrDt361nzkiW7U+y5CltyaUlbzqySiPqhc0vpaEzjs72P8Yrm5a3U8N75DikL/bJxCGd/9mJk3jxJ504JuN/8bMRT2vLI815tppGFDRlRS0KVNkiS0mdV1jjGCYYpxfjYueNYXptjC/6cbOe7hyJqCnLlo/3PW+/dux2H/ifvzn+3vH5scM/XxFFje1njBvp7EBnR9ww44bXmmh+bXi6s/hRRdkOa+9EbUgLRRAcCYMDl8Bn7985nmPCe8HlJgiinEskKFVPrWe0nXBrsgnvqR1lVTFYR68tMDMOA22ryYuKoqhopMJagzEd1hics99702m03nDO4T2qHpGXONfTqhZj7HpYlBWn8wX/EnAOQoLrjdM5WDmefKI4IYof3O7xN7Vstx4ugn3f87WWCutGEt6ib67RnVsUEyfp+nixjzQjTrLVTzJBLRVeZyyiqLD6SZelPKOI9vGgKEou4ZXwGhFcN9FFQBQlqShIRb6KLLHFX2KNarehLIK6VsT7AyIMEGGIlJIkyyiqCtU+qaVEqnbt5xfLL1akoqobtDF42mxf7jqzDkeq5WJDIyVKqR/TKrUW8RfobD9A13lxyAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ask-chatgpt-chromium-4\"\n        title=\"ask-chatgpt-chromium-4\"\n        src=\"/static/7ff2356ab737c05cd4fafa5854d2ea46/f058b/ask-chatgpt-chromium-4.png\"\n        srcset=\"/static/7ff2356ab737c05cd4fafa5854d2ea46/c26ae/ask-chatgpt-chromium-4.png 158w,\n/static/7ff2356ab737c05cd4fafa5854d2ea46/6bdcf/ask-chatgpt-chromium-4.png 315w,\n/static/7ff2356ab737c05cd4fafa5854d2ea46/f058b/ask-chatgpt-chromium-4.png 630w,\n/static/7ff2356ab737c05cd4fafa5854d2ea46/40601/ask-chatgpt-chromium-4.png 945w,\n/static/7ff2356ab737c05cd4fafa5854d2ea46/78612/ask-chatgpt-chromium-4.png 1260w,\n/static/7ff2356ab737c05cd4fafa5854d2ea46/764d0/ask-chatgpt-chromium-4.png 1898w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>And then I traced to <a href=\"https://source.chromium.org/chromium/chromium/src/+/refs/heads/main:url/url_util.cc;drc=9329f990b89052f1e7f82e0a1a4b298b72359263;l=317\"><code class=\"language-text\">DoResolveRelative()</code></a> in <code class=\"language-text\">url/url_util.cc</code>. We’re getting close!</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token keyword\">template</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">typename</span> <span class=\"token class-name\">CHAR</span><span class=\"token operator\">></span>\n<span class=\"token keyword\">bool</span> <span class=\"token function\">DoResolveRelative</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> base_spec<span class=\"token punctuation\">,</span>\n                       <span class=\"token keyword\">int</span> base_spec_len<span class=\"token punctuation\">,</span>\n                       <span class=\"token keyword\">const</span> Parsed<span class=\"token operator\">&amp;</span> base_parsed<span class=\"token punctuation\">,</span>\n                       <span class=\"token keyword\">const</span> CHAR<span class=\"token operator\">*</span> in_relative<span class=\"token punctuation\">,</span>\n                       <span class=\"token keyword\">int</span> in_relative_length<span class=\"token punctuation\">,</span>\n                       CharsetConverter<span class=\"token operator\">*</span> charset_converter<span class=\"token punctuation\">,</span>\n                       CanonOutput<span class=\"token operator\">*</span> output<span class=\"token punctuation\">,</span>\n                       Parsed<span class=\"token operator\">*</span> output_parsed<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Remove any whitespace from the middle of the relative URL, possibly</span>\n  <span class=\"token comment\">// copying to the new buffer.</span>\n  STACK_UNINITIALIZED RawCanonOutputT<span class=\"token operator\">&lt;</span>CHAR<span class=\"token operator\">></span> whitespace_buffer<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">int</span> relative_length<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> CHAR<span class=\"token operator\">*</span> relative <span class=\"token operator\">=</span> <span class=\"token function\">RemoveURLWhitespace</span><span class=\"token punctuation\">(</span>\n      in_relative<span class=\"token punctuation\">,</span> in_relative_length<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>whitespace_buffer<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>relative_length<span class=\"token punctuation\">,</span>\n      <span class=\"token operator\">&amp;</span>output_parsed<span class=\"token operator\">-></span>potentially_dangling_markup<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">bool</span> base_is_authority_based <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">bool</span> base_is_hierarchical <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>base_spec <span class=\"token operator\">&amp;&amp;</span>\n      base_parsed<span class=\"token punctuation\">.</span>scheme<span class=\"token punctuation\">.</span><span class=\"token function\">is_nonempty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> after_scheme <span class=\"token operator\">=</span> base_parsed<span class=\"token punctuation\">.</span>scheme<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// Skip past the colon.</span>\n    <span class=\"token keyword\">int</span> num_slashes <span class=\"token operator\">=</span> <span class=\"token function\">CountConsecutiveSlashes</span><span class=\"token punctuation\">(</span>base_spec<span class=\"token punctuation\">,</span> after_scheme<span class=\"token punctuation\">,</span>\n                                              base_spec_len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    base_is_authority_based <span class=\"token operator\">=</span> num_slashes <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n    base_is_hierarchical <span class=\"token operator\">=</span> num_slashes <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  SchemeType unused_scheme_type <span class=\"token operator\">=</span> SCHEME_WITH_HOST_PORT_AND_USER_INFORMATION<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">bool</span> standard_base_scheme <span class=\"token operator\">=</span>\n      base_parsed<span class=\"token punctuation\">.</span>scheme<span class=\"token punctuation\">.</span><span class=\"token function\">is_nonempty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n      <span class=\"token function\">DoIsStandard</span><span class=\"token punctuation\">(</span>base_spec<span class=\"token punctuation\">,</span> base_parsed<span class=\"token punctuation\">.</span>scheme<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>unused_scheme_type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">bool</span> is_relative<span class=\"token punctuation\">;</span>\n  Component relative_component<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">IsRelativeURL</span><span class=\"token punctuation\">(</span>base_spec<span class=\"token punctuation\">,</span> base_parsed<span class=\"token punctuation\">,</span> relative<span class=\"token punctuation\">,</span> relative_length<span class=\"token punctuation\">,</span>\n                     <span class=\"token punctuation\">(</span>base_is_hierarchical <span class=\"token operator\">||</span> standard_base_scheme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                     <span class=\"token operator\">&amp;</span>is_relative<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>relative_component<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Error resolving.</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Don't reserve buffer space here. Instead, reserve in DoCanonicalize and</span>\n  <span class=\"token comment\">// ReserveRelativeURL, to enable more accurate buffer sizes.</span>\n\n  <span class=\"token comment\">// Pretend for a moment that |base_spec| is a standard URL. Normally</span>\n  <span class=\"token comment\">// non-standard URLs are treated as PathURLs, but if the base has an</span>\n  <span class=\"token comment\">// authority we would like to preserve it.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>is_relative <span class=\"token operator\">&amp;&amp;</span> base_is_authority_based <span class=\"token operator\">&amp;&amp;</span> <span class=\"token operator\">!</span>standard_base_scheme<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Parsed base_parsed_authority<span class=\"token punctuation\">;</span>\n    <span class=\"token function\">ParseStandardURL</span><span class=\"token punctuation\">(</span>base_spec<span class=\"token punctuation\">,</span> base_spec_len<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>base_parsed_authority<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>base_parsed_authority<span class=\"token punctuation\">.</span>host<span class=\"token punctuation\">.</span><span class=\"token function\">is_nonempty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      STACK_UNINITIALIZED RawCanonOutputT<span class=\"token operator\">&lt;</span><span class=\"token keyword\">char</span><span class=\"token operator\">></span> temporary_output<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">bool</span> did_resolve_succeed <span class=\"token operator\">=</span>\n          <span class=\"token function\">ResolveRelativeURL</span><span class=\"token punctuation\">(</span>base_spec<span class=\"token punctuation\">,</span> base_parsed_authority<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> relative<span class=\"token punctuation\">,</span>\n                             relative_component<span class=\"token punctuation\">,</span> charset_converter<span class=\"token punctuation\">,</span>\n                             <span class=\"token operator\">&amp;</span>temporary_output<span class=\"token punctuation\">,</span> output_parsed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// The output_parsed is incorrect at this point (because it was built</span>\n      <span class=\"token comment\">// based on base_parsed_authority instead of base_parsed) and needs to be</span>\n      <span class=\"token comment\">// re-created.</span>\n      <span class=\"token function\">DoCanonicalize</span><span class=\"token punctuation\">(</span>temporary_output<span class=\"token punctuation\">.</span><span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> temporary_output<span class=\"token punctuation\">.</span><span class=\"token function\">length</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                     REMOVE_WHITESPACE<span class=\"token punctuation\">,</span> charset_converter<span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">,</span>\n                     output_parsed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> did_resolve_succeed<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>is_relative<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Relative, resolve and canonicalize.</span>\n    <span class=\"token keyword\">bool</span> file_base_scheme <span class=\"token operator\">=</span> base_parsed<span class=\"token punctuation\">.</span>scheme<span class=\"token punctuation\">.</span><span class=\"token function\">is_nonempty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n        <span class=\"token function\">DoCompareSchemeComponent</span><span class=\"token punctuation\">(</span>base_spec<span class=\"token punctuation\">,</span> base_parsed<span class=\"token punctuation\">.</span>scheme<span class=\"token punctuation\">,</span> kFileScheme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">ResolveRelativeURL</span><span class=\"token punctuation\">(</span>base_spec<span class=\"token punctuation\">,</span> base_parsed<span class=\"token punctuation\">,</span> file_base_scheme<span class=\"token punctuation\">,</span> relative<span class=\"token punctuation\">,</span>\n                              relative_component<span class=\"token punctuation\">,</span> charset_converter<span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">,</span>\n                              output_parsed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Not relative, canonicalize the input.</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">DoCanonicalize</span><span class=\"token punctuation\">(</span>relative<span class=\"token punctuation\">,</span> relative_length<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n                        DO_NOT_REMOVE_WHITESPACE<span class=\"token punctuation\">,</span> charset_converter<span class=\"token punctuation\">,</span> output<span class=\"token punctuation\">,</span>\n                        output_parsed<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And then we get closer:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d2b9dd32cde521ab97f9a029f0ab4409/691b3/ask-chatgpt-chromium-5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.21518987341771%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACZUlEQVQ4y42T6W7jNhhF9f4P1gKTH8V0Ei+JY+2UKFMURVGSbS2nED1t08y0KIGDSwrk1beQgTI9UWFRZqS2t/+Faq//QNuRZqO7Esja8vt7TawmUr2S1DNJvfi5X6uZ+BPJB7a10HfK5uY10K0jjhuyUBOeJO/nAiEMlezJCo0yA90Idliw44odfuQ+rUwznqAxHapumaaV63XiPi/orGP3/Mr++Mrb6Uw/3JgX/MH7/CPLsrKsD4LGWNq25eMQmeBw2PP29kYcR/TOMQzDhx0r/zaCpu3QjaHJMuok8Zof9sg45pJl6LKk0xqrFKO1TM7BunrLddNPBGYzrBtEJNjtXjidTuRZRpokpGmKEAKtNY3WOOcYx5Hb7faI82eGj5Q7nO3J85yyLL1JIQqkkFSXCmsty7IwTZM32/Q/U25qwyVXxElMGIaeMpXoqqHve7rOedPWWh9l13VY23nd6u++13j7kU/ZtBZnHHkuPEVRIqWklBIhCh91WUqfQVEU3/cUft+fWTVN400DWSm0bjDGoFSNrCqUNvTDiHM9/TB4hmH0Ol6v3O53pmn2ujHPi4/UG2Z5QVUpjDZEScLL/sDzbs/ucPTzTbf7uOn2/T2MiNMMeVEY29G0lrZz1LVmHAeCNBN+cR2uyEtNmGSco4TTOSSM/9ZzFBPGKYWsyESBNi2t672ZdT2dc75hQS5K1EWTRSlPT7/w5elXfvv6lW/PLxyOr+x9hMe/5sfXN5I046IUqtaouuaiakzbMs/zI2WtDa5tKOITRXTifXshSUIURf4KbV3fdCu+tY+DW0c/s93DPwDbo3EYhORtbwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ask-chatgpt-chromium-5\"\n        title=\"ask-chatgpt-chromium-5\"\n        src=\"/static/d2b9dd32cde521ab97f9a029f0ab4409/f058b/ask-chatgpt-chromium-5.png\"\n        srcset=\"/static/d2b9dd32cde521ab97f9a029f0ab4409/c26ae/ask-chatgpt-chromium-5.png 158w,\n/static/d2b9dd32cde521ab97f9a029f0ab4409/6bdcf/ask-chatgpt-chromium-5.png 315w,\n/static/d2b9dd32cde521ab97f9a029f0ab4409/f058b/ask-chatgpt-chromium-5.png 630w,\n/static/d2b9dd32cde521ab97f9a029f0ab4409/40601/ask-chatgpt-chromium-5.png 945w,\n/static/d2b9dd32cde521ab97f9a029f0ab4409/78612/ask-chatgpt-chromium-5.png 1260w,\n/static/d2b9dd32cde521ab97f9a029f0ab4409/691b3/ask-chatgpt-chromium-5.png 2156w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>At first glance, the function <code class=\"language-text\">IsRelativeURL()</code> only process the params and return a boolean.\nBut after a closer look, the function is also putting the url result in the\npointer param. Oh right, it’s a norm to do that in C++.</p>\n<p>And finally we get to <a href=\"https://source.chromium.org/chromium/chromium/src/+/refs/heads/main:url/url_canon_relative.cc;l=103;drc=9329f990b89052f1e7f82e0a1a4b298b72359263;bpv=0;bpt=1\"><code class=\"language-text\">DoIsRelativeURL()</code></a> in <code class=\"language-text\">url/url_canon_relative.cc</code>,\nthat follow some logic to determine if the string is a relative url or absolute url.</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token comment\">// See IsRelativeURL in the header file for usage.</span>\n<span class=\"token keyword\">template</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">typename</span> <span class=\"token class-name\">CHAR</span><span class=\"token operator\">></span>\n<span class=\"token keyword\">bool</span> <span class=\"token function\">DoIsRelativeURL</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">char</span><span class=\"token operator\">*</span> base<span class=\"token punctuation\">,</span>\n                     <span class=\"token keyword\">const</span> Parsed<span class=\"token operator\">&amp;</span> base_parsed<span class=\"token punctuation\">,</span>\n                     <span class=\"token keyword\">const</span> CHAR<span class=\"token operator\">*</span> url<span class=\"token punctuation\">,</span>\n                     <span class=\"token keyword\">int</span> url_len<span class=\"token punctuation\">,</span>\n                     <span class=\"token keyword\">bool</span> is_base_hierarchical<span class=\"token punctuation\">,</span>\n                     <span class=\"token keyword\">bool</span><span class=\"token operator\">*</span> is_relative<span class=\"token punctuation\">,</span>\n                     Component<span class=\"token operator\">*</span> relative_component<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">*</span>is_relative <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// So we can default later to not relative.</span>\n\n  <span class=\"token comment\">// Trim whitespace and construct a new range for the substring.</span>\n  <span class=\"token keyword\">int</span> begin <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">TrimURL</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>begin<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>url_len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>begin <span class=\"token operator\">>=</span> url_len<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Empty URLs are relative, but do nothing.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>is_base_hierarchical<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Don't allow relative URLs if the base scheme doesn't support it.</span>\n      <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">*</span>relative_component <span class=\"token operator\">=</span> <span class=\"token function\">Component</span><span class=\"token punctuation\">(</span>begin<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">*</span>is_relative <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifdef</span> <span class=\"token expression\">WIN32</span></span>\n  <span class=\"token comment\">// We special case paths like \"C:\\foo\" so they can link directly to the</span>\n  <span class=\"token comment\">// file on Windows (IE compatibility). The security domain stuff should</span>\n  <span class=\"token comment\">// prevent a link like this from actually being followed if its on a</span>\n  <span class=\"token comment\">// web page.</span>\n  <span class=\"token comment\">//</span>\n  <span class=\"token comment\">// We treat \"C:/foo\" as an absolute URL. We can go ahead and treat \"/c:/\"</span>\n  <span class=\"token comment\">// as relative, as this will just replace the path when the base scheme</span>\n  <span class=\"token comment\">// is a file and the answer will still be correct.</span>\n  <span class=\"token comment\">//</span>\n  <span class=\"token comment\">// We require strict backslashes when detecting UNC since two forward</span>\n  <span class=\"token comment\">// slashes should be treated a a relative URL with a hostname.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">DoesBeginWindowsDriveSpec</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> begin<span class=\"token punctuation\">,</span> url_len<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span>\n      <span class=\"token function\">DoesBeginUNCPath</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> begin<span class=\"token punctuation\">,</span> url_len<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span>  <span class=\"token comment\">// WIN32</span></span>\n\n  <span class=\"token comment\">// See if we've got a scheme, if not, we know this is a relative URL.</span>\n  <span class=\"token comment\">// BUT, just because we have a scheme, doesn't make it absolute.</span>\n  <span class=\"token comment\">// \"http:foo.html\" is a relative URL with path \"foo.html\". If the scheme is</span>\n  <span class=\"token comment\">// empty, we treat it as relative (\":foo\"), like IE does.</span>\n  Component scheme<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token keyword\">bool</span> scheme_is_empty <span class=\"token operator\">=</span>\n      <span class=\"token operator\">!</span><span class=\"token function\">ExtractScheme</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> url_len<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>scheme<span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> scheme<span class=\"token punctuation\">.</span>len <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>scheme_is_empty<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">[</span>begin<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'#'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// |url| is a bare fragment (e.g. \"#foo\"). This can be resolved against</span>\n      <span class=\"token comment\">// any base. Fall-through.</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>is_base_hierarchical<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Don't allow relative URLs if the base scheme doesn't support it.</span>\n      <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token operator\">*</span>relative_component <span class=\"token operator\">=</span> <span class=\"token function\">MakeRange</span><span class=\"token punctuation\">(</span>begin<span class=\"token punctuation\">,</span> url_len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">*</span>is_relative <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// If the scheme isn't valid, then it's relative.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">IsValidScheme</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> scheme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">[</span>begin<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'#'</span> <span class=\"token operator\">&amp;&amp;</span>\n        base<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">FeatureList</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">IsEnabled</span><span class=\"token punctuation\">(</span>\n            kResolveBareFragmentWithColonOnNonHierarchical<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// |url| is a bare fragment (e.g. \"#foo:bar\"). This can be resolved</span>\n      <span class=\"token comment\">// against any base. Fall-through.</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>is_base_hierarchical<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// Don't allow relative URLs if the base scheme doesn't support it.</span>\n      <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">*</span>relative_component <span class=\"token operator\">=</span> <span class=\"token function\">MakeRange</span><span class=\"token punctuation\">(</span>begin<span class=\"token punctuation\">,</span> url_len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">*</span>is_relative <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// If the scheme is not the same, then we can't count it as relative.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">AreSchemesEqual</span><span class=\"token punctuation\">(</span>base<span class=\"token punctuation\">,</span> base_parsed<span class=\"token punctuation\">.</span>scheme<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> scheme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// When the scheme that they both share is not hierarchical, treat the</span>\n  <span class=\"token comment\">// incoming scheme as absolute (this way with the base of \"data:foo\",</span>\n  <span class=\"token comment\">// \"data:bar\" will be reported as absolute.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>is_base_hierarchical<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">int</span> colon_offset <span class=\"token operator\">=</span> scheme<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// If it's a filesystem URL, the only valid way to make it relative is not to</span>\n  <span class=\"token comment\">// supply a scheme. There's no equivalent to e.g. http:index.html.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token function\">CompareSchemeComponent</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> scheme<span class=\"token punctuation\">,</span> kFileSystemScheme<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ExtractScheme guarantees that the colon immediately follows what it</span>\n  <span class=\"token comment\">// considers to be the scheme. CountConsecutiveSlashes will handle the</span>\n  <span class=\"token comment\">// case where the begin offset is the end of the input.</span>\n  <span class=\"token keyword\">int</span> num_slashes <span class=\"token operator\">=</span> <span class=\"token function\">CountConsecutiveSlashes</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> colon_offset <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> url_len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>num_slashes <span class=\"token operator\">==</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> num_slashes <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// No slashes means it's a relative path like \"http:foo.html\". One slash</span>\n    <span class=\"token comment\">// is an absolute path. \"http:/home/foo.html\"</span>\n    <span class=\"token operator\">*</span>is_relative <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n    <span class=\"token operator\">*</span>relative_component <span class=\"token operator\">=</span> <span class=\"token function\">MakeRange</span><span class=\"token punctuation\">(</span>colon_offset <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> url_len<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Two or more slashes after the scheme we treat as absolute.</span>\n  <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Near the end of the function, the code is counting the number of consecutive slashes\n(at the beginning of the substring, right after scheme colon offset, if any)\nto determine if the url is a relative one. But it doesn’t mention whether\nit’s slash or backslash. Hmmmmm.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/64c29728064f5ba5e489ee7eb8e5b90d/66632/ask-chatgpt-chromium-6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABbklEQVQoz63R227TQBCAYb//g3ETgTDQpCVNbCdxfNiDveOzY/tHNSnqBQgVMdKnmR1p52LGs9JiXIdxLda1jOPAOPTv1vfdygvTim+h8BAJ20gIsp5Qjf/M258tH59y/L1i8xCvw4/5xCG7/cH0G/d+PuEpZajrmv8Ty8+BbS2MzjK6glEKBq2Ym5reaHqtGMqCNksYCsso7pfBlWvurWEe+nWkd0ktp2dF9OVC4Ec8bw5sN1u2/o7klHI5nEmihOQQk6eWUgZcNSDNjerOyct7ouoXvCA2RJFwPXfE15boWhElQhBbYlVzVkIcN4RHwX8M8XcBYVyS5gPBteSUClombAO2mvGUMXRVQ2daztF3DvvPXKJHmlqwRq+5MBqtMqrKMU83WGaY57Ve5tu6u9fw0lzTNC2tdDztvuJ/+kB43KJUTpbnaG1QSiEiaz2O4339b06xvFhWXpZrXCl0ZY+UFW3X//2W989vvfZ/AAuj/F+ii19eAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ask-chatgpt-chromium-6\"\n        title=\"ask-chatgpt-chromium-6\"\n        src=\"/static/64c29728064f5ba5e489ee7eb8e5b90d/f058b/ask-chatgpt-chromium-6.png\"\n        srcset=\"/static/64c29728064f5ba5e489ee7eb8e5b90d/c26ae/ask-chatgpt-chromium-6.png 158w,\n/static/64c29728064f5ba5e489ee7eb8e5b90d/6bdcf/ask-chatgpt-chromium-6.png 315w,\n/static/64c29728064f5ba5e489ee7eb8e5b90d/f058b/ask-chatgpt-chromium-6.png 630w,\n/static/64c29728064f5ba5e489ee7eb8e5b90d/40601/ask-chatgpt-chromium-6.png 945w,\n/static/64c29728064f5ba5e489ee7eb8e5b90d/78612/ask-chatgpt-chromium-6.png 1260w,\n/static/64c29728064f5ba5e489ee7eb8e5b90d/66632/ask-chatgpt-chromium-6.png 1504w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>A function <a href=\"https://source.chromium.org/chromium/chromium/src/+/refs/heads/main:url/url_parse_internal.h;l=15;drc=991110a34dafb7233475cdfa91c3416d1e91b724;bpv=1;bpt=1\"><code class=\"language-text\">IsURLSlash()</code></a>…?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/323874d36260238920f40a5b09259048/985a9/ask-chatgpt-chromium-7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABhUlEQVQoz4XRa2+bMBiGYf7/j6vWbu1yaKEhgYSDsQ0+YRLuKTTalqlTX+mSn+eLJb9OZO+opaNRnqpz9DYQ40gYA+Nv45dCCItEqIHvmeZhK3nYdDymms1xurO+KiPrY7w/y7/6YiJRvWWVNXxbHXjalDyuC16ylue0WTxtT6RHy0nPHNXlS4l1gb4fmIMjqo5JK0JbE5UkannL3Y1k7FrOpifKjlGKpU+9WvLZDiTGeqpaoJSm1z3aDYhB0Q5ycc3SajqjaPoOO3rmGS6X+VPLhUIIfOfwrcVZw3yZ+Hzm//gzSW88b7ngkHXk64rd9sTqxyubl4y35z27nyXpKifPKoq8pdwLjqWi2NUcsmrpjRzpzIwYLiSDDbwfWurSUu0MRSEpG8mhEuT7llY4amXQbsJFFibMNx95uPIfEuM8TdNgG4M9GZqiJk1f2b/v0IVCV5K+VZxtxFuLd+af59/PssPjqSaGyBTOWOcw1uBdYPIT0U+MLhLdRPABH8LyKfM8f+oX5TX9n6dsyp4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ask-chatgpt-chromium-7\"\n        title=\"ask-chatgpt-chromium-7\"\n        src=\"/static/323874d36260238920f40a5b09259048/f058b/ask-chatgpt-chromium-7.png\"\n        srcset=\"/static/323874d36260238920f40a5b09259048/c26ae/ask-chatgpt-chromium-7.png 158w,\n/static/323874d36260238920f40a5b09259048/6bdcf/ask-chatgpt-chromium-7.png 315w,\n/static/323874d36260238920f40a5b09259048/f058b/ask-chatgpt-chromium-7.png 630w,\n/static/323874d36260238920f40a5b09259048/40601/ask-chatgpt-chromium-7.png 945w,\n/static/323874d36260238920f40a5b09259048/78612/ask-chatgpt-chromium-7.png 1260w,\n/static/323874d36260238920f40a5b09259048/985a9/ask-chatgpt-chromium-7.png 1512w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Omg, it treats backslash the same as normal slash, for IE compatibility!</p>\n<p>Which means, the string <code class=\"language-text\">\\\\abc.com</code> could also cause domain change in redirect.</p>\n<h1 id=\"what-ive-learnt\" style=\"position:relative;\"><a href=\"#what-ive-learnt\" aria-label=\"what ive learnt permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What I’ve learnt</h1>\n<p>First of all, <strong>the browser redirect url construction is complicated, and not standardized</strong>.\nWe must rely on browser API to produce the exact result.</p>\n<p>Second, ChatGPT’s performance is extraordinary!\nAlthough it could not give us the correct answer like a miracle machine,\n<strong>the guidance from ChatGPT in reading source code significantly reduced the learning barrier</strong>. It’s like\ngetting help from a chromium developer, pointing directions for you to understand the codebase.\nIf you feed it a function source code, it can do a very good summary about what the code is doing.\nCan’t imagine how far would it get after a year or two.</p>","frontmatter":{"title":"Why brwoser redirect to different domain with text \"/\\abc.com\"?","date":"April 12, 2023","description":null}},"previous":{"fields":{"slug":"/2022-06-25-multi-threading-in-node-js/"},"frontmatter":{"title":"Multi threading in node-js"}},"next":{"fields":{"slug":"/2023-05-04-typescript-nodejs-scripts-folder-setup-with-esm-imports/"},"frontmatter":{"title":"The Right Setup to Run TypeScript with Node.js and Importing ESM NPM Modules in a TypeScript Web Frontend"}}},"pageContext":{"id":"a4c5fe89-d85c-5d91-83a0-c7d1a9e024b2","previousPostId":"8ea52748-2c95-58a2-a78e-340640b676a1","nextPostId":"482f1784-87e3-58c1-9b3f-55990c610d7a"}},
    "staticQueryHashes": ["1776624730","3000541721","3274528899"]}